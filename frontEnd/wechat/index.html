<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>爱哭的小河豚</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="何必固执的追逐光明，可以尝试让自己发光。">
    
    <link rel="preload" href="/study/assets/css/0.styles.1e2cf360.css" as="style"><link rel="preload" href="/study/assets/js/app.64a3878e.js" as="script"><link rel="preload" href="/study/assets/js/3.bf789c24.js" as="script"><link rel="preload" href="/study/assets/js/4.41404aa1.js" as="script"><link rel="prefetch" href="/study/assets/js/10.f340e70a.js"><link rel="prefetch" href="/study/assets/js/11.aa6018f4.js"><link rel="prefetch" href="/study/assets/js/12.14e3a58d.js"><link rel="prefetch" href="/study/assets/js/13.1a3e7553.js"><link rel="prefetch" href="/study/assets/js/14.56cfc3cf.js"><link rel="prefetch" href="/study/assets/js/15.cdc54dee.js"><link rel="prefetch" href="/study/assets/js/16.464ec9a8.js"><link rel="prefetch" href="/study/assets/js/17.941f1fce.js"><link rel="prefetch" href="/study/assets/js/18.b7b50ce5.js"><link rel="prefetch" href="/study/assets/js/19.4ca18b69.js"><link rel="prefetch" href="/study/assets/js/2.7f7d4902.js"><link rel="prefetch" href="/study/assets/js/20.5b1c1341.js"><link rel="prefetch" href="/study/assets/js/21.43c153b0.js"><link rel="prefetch" href="/study/assets/js/22.30333923.js"><link rel="prefetch" href="/study/assets/js/23.e0201095.js"><link rel="prefetch" href="/study/assets/js/24.5fb99ade.js"><link rel="prefetch" href="/study/assets/js/25.bda0e65b.js"><link rel="prefetch" href="/study/assets/js/26.8699c0ee.js"><link rel="prefetch" href="/study/assets/js/27.6b349317.js"><link rel="prefetch" href="/study/assets/js/28.937a683f.js"><link rel="prefetch" href="/study/assets/js/5.670c60cf.js"><link rel="prefetch" href="/study/assets/js/6.faa210c0.js"><link rel="prefetch" href="/study/assets/js/7.c49c4bfe.js"><link rel="prefetch" href="/study/assets/js/8.72f2f35f.js"><link rel="prefetch" href="/study/assets/js/9.0c98da48.js">
    <link rel="stylesheet" href="/study/assets/css/0.styles.1e2cf360.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study/" class="home-link router-link-active"><img src="/study/logo/logo.jpg" alt="爱哭的小河豚" class="logo"> <span class="site-name can-hide">爱哭的小河豚</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study/frontEnd/basics/" class="nav-link">
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/es6/" class="nav-link">
  es6-es11
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/json&amp;ajax/" class="nav-link">
  json&amp;ajax
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/vue2/" class="nav-link">
  vue2
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/ts&amp;vue3/" class="nav-link">
  ts&amp;vue3
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/wechat/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  wechat
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study/afterEnd/java/" class="nav-link">
  java
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/jdbc/" class="nav-link">
  jdbc
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/javaweb/" class="nav-link">
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/ssm/" class="nav-link">
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/mybatisplus/" class="nav-link">
  MyBatis Plus
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/springboot/" class="nav-link">
  Spring Boot
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/springcould/" class="nav-link">
  Spring Could
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/arithmetic/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/python/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><a href="/study/version/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/study/tool/idea/" class="nav-link">
  idea
</a></div><div class="nav-item"><a href="/study/favorite/" class="nav-link">
  收藏夹
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study/frontEnd/basics/" class="nav-link">
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/es6/" class="nav-link">
  es6-es11
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/json&amp;ajax/" class="nav-link">
  json&amp;ajax
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/vue2/" class="nav-link">
  vue2
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/ts&amp;vue3/" class="nav-link">
  ts&amp;vue3
</a></li><li class="dropdown-item"><!----> <a href="/study/frontEnd/wechat/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  wechat
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study/afterEnd/java/" class="nav-link">
  java
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/jdbc/" class="nav-link">
  jdbc
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/javaweb/" class="nav-link">
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/ssm/" class="nav-link">
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/mybatisplus/" class="nav-link">
  MyBatis Plus
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/springboot/" class="nav-link">
  Spring Boot
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/springcould/" class="nav-link">
  Spring Could
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/arithmetic/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/study/afterEnd/python/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><a href="/study/version/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/study/tool/idea/" class="nav-link">
  idea
</a></div><div class="nav-item"><a href="/study/favorite/" class="nav-link">
  收藏夹
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study/frontEnd/wechat/#项目目录" class="sidebar-link">项目目录</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#创建项目" class="sidebar-link">创建项目</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#页面组件" class="sidebar-link">页面组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#页面样式" class="sidebar-link">页面样式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#选择器" class="sidebar-link">选择器</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#尺寸单位" class="sidebar-link">尺寸单位</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#样式导入" class="sidebar-link">样式导入</a></li></ul></li><li><a href="/study/frontEnd/wechat/#配置文件" class="sidebar-link">配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#页面级配置文件-index-json" class="sidebar-link">页面级配置文件(index.json)</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#应用级配置文件-app-json" class="sidebar-link">应用级配置文件(app.json)</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#networktimeout" class="sidebar-link" style="padding-left:3rem;">networkTimeout</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#tabbar" class="sidebar-link" style="padding-left:3rem;">tabBar</a></li></ul></li><li><a href="/study/frontEnd/wechat/#页面逻辑-index-js" class="sidebar-link">页面逻辑(index.js)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#生命周期回调函数" class="sidebar-link">生命周期回调函数</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#onload" class="sidebar-link" style="padding-left:3rem;">onLoad</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#onshareappmessage-onshow-onhide" class="sidebar-link" style="padding-left:3rem;">onShareAppMessage /onShow/onHide</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#页面事件处理函数" class="sidebar-link">页面事件处理函数</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#组件事件处理函数" class="sidebar-link">组件事件处理函数</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#target和currenttarget的区别" class="sidebar-link" style="padding-left:3rem;">target和currentTarget的区别</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#常用事件" class="sidebar-link" style="padding-left:3rem;">常用事件</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#事件绑定和冒泡" class="sidebar-link" style="padding-left:3rem;">事件绑定和冒泡</a></li></ul></li><li><a href="/study/frontEnd/wechat/#注册程序-app-js" class="sidebar-link">注册程序（app.js）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#案例1-实现比较功能" class="sidebar-link">案例1：实现比较功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#为两个input绑定不同事件处理函数" class="sidebar-link">为两个input绑定不同事件处理函数</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#为两个input绑定相同事件处理函数" class="sidebar-link">为两个input绑定相同事件处理函数</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#直接在页面上比较-三元运算符" class="sidebar-link">直接在页面上比较（三元运算符）</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#通过条件渲染显示不同结果" class="sidebar-link">通过条件渲染显示不同结果</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#通过表单获取input组件的值" class="sidebar-link">通过表单获取input组件的值</a></li></ul></li><li><a href="/study/frontEnd/wechat/#案例2-调查问卷" class="sidebar-link">案例2：调查问卷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#获取表单数据" class="sidebar-link">获取表单数据</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#服务器交互" class="sidebar-link">服务器交互</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#使用node搭建后台" class="sidebar-link" style="padding-left:3rem;">使用node搭建后台</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#音乐小程序项目" class="sidebar-link">音乐小程序项目</a></li></ul></li><li><a href="/study/frontEnd/wechat/#swiper组件" class="sidebar-link">swiper组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#include代码引用" class="sidebar-link">include代码引用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#scroll-view组件" class="sidebar-link">scroll-view组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#隐藏滚动条" class="sidebar-link">隐藏滚动条</a></li></ul></li><li><a href="/study/frontEnd/wechat/#image组件" class="sidebar-link">image组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#音频api" class="sidebar-link">音频API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#旋转动画" class="sidebar-link">旋转动画</a></li></ul></li><li><a href="/study/frontEnd/wechat/#slider组件" class="sidebar-link">slider组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#婚礼邀请函小程序项目" class="sidebar-link">婚礼邀请函小程序项目</a></li></ul></li><li><a href="/study/frontEnd/wechat/#背景音乐api" class="sidebar-link">背景音乐API</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#背景图片" class="sidebar-link">背景图片</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#拨打电话api" class="sidebar-link">拨打电话API</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#视频api" class="sidebar-link">视频API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#video组件" class="sidebar-link">video组件</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#获取本地视频" class="sidebar-link" style="padding-left:3rem;">获取本地视频</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#腾讯视频插件" class="sidebar-link">腾讯视频插件</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#wxs" class="sidebar-link">WXS</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#模块" class="sidebar-link" style="padding-left:3rem;">模块</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#require函数" class="sidebar-link" style="padding-left:3rem;">require函数</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#wxs增强页面功能" class="sidebar-link" style="padding-left:3rem;">wxs增强页面功能</a></li></ul></li><li><a href="/study/frontEnd/wechat/#map组件" class="sidebar-link">map组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#标记点" class="sidebar-link">标记点</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#定位自己位置" class="sidebar-link">定位自己位置</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#controls设置" class="sidebar-link">controls设置</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#获取控件id" class="sidebar-link" style="padding-left:3rem;">获取控件id</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#回到当前位置" class="sidebar-link">回到当前位置</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#获取中心点坐标" class="sidebar-link">获取中心点坐标</a></li></ul></li><li><a href="/study/frontEnd/wechat/#picker" class="sidebar-link">picker</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#弹框提示" class="sidebar-link">弹框提示</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#发送婚礼请帖回复通知" class="sidebar-link">发送婚礼请帖回复通知</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#获取订阅消息模板" class="sidebar-link">获取订阅消息模板</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#获取订阅消息权限" class="sidebar-link">获取订阅消息权限</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#发送订阅消息" class="sidebar-link">发送订阅消息???</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#api应用" class="sidebar-link">API应用</a></li></ul></li><li><a href="/study/frontEnd/wechat/#用户登录" class="sidebar-link">用户登录</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#数据缓存" class="sidebar-link">数据缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#实现用户登录" class="sidebar-link">实现用户登录</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#获取登录积分" class="sidebar-link">获取登录积分</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#检查是否登录" class="sidebar-link">检查是否登录</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#获取用户信息" class="sidebar-link">获取用户信息</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#开放数据校验和解密" class="sidebar-link">开放数据校验和解密</a></li></ul></li><li><a href="/study/frontEnd/wechat/#wx-switchtab" class="sidebar-link">wx.switchTab</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#wx-navigateto和wx-redirectto" class="sidebar-link">wx.navigateTo和wx.redirectTo</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#wx-relaunch" class="sidebar-link">wx.reLaunch</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#wx-chooseimage" class="sidebar-link">wx.chooseImage</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#wx-makephonecall" class="sidebar-link">wx.makePhoneCall</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#腾讯地图附近地点查找api" class="sidebar-link">腾讯地图附近地点查找API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#sdk导入" class="sidebar-link">sdk导入</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#获取手机系统信息" class="sidebar-link">获取手机系统信息</a></li></ul></li><li><a href="/study/frontEnd/wechat/#canvas" class="sidebar-link">canvas???</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#canvas-2d-示例代码" class="sidebar-link">Canvas 2D 示例代码</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#webgl-示例代码" class="sidebar-link">WebGL 示例代码</a></li></ul></li><li><a href="/study/frontEnd/wechat/#动画" class="sidebar-link">动画???</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#wx-createanimation" class="sidebar-link">wx.createAnimation</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#animation" class="sidebar-link">animation</a></li></ul></li><li><a href="/study/frontEnd/wechat/#录音api" class="sidebar-link">录音API</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#文件上传与下载" class="sidebar-link">文件上传与下载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#上传" class="sidebar-link">上传</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#下载" class="sidebar-link">下载</a></li></ul></li><li><a href="/study/frontEnd/wechat/#录音上传" class="sidebar-link">录音上传</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#音频下载" class="sidebar-link">音频下载</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/frontEnd/wechat/#在线聊天" class="sidebar-link">在线聊天</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#websocket" class="sidebar-link">WebSocket</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#wx-sendsocketmessage" class="sidebar-link">wx.sendSocketMessage</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#wx-onsocketmessage" class="sidebar-link">wx.onSocketMessage</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#案例实现" class="sidebar-link">案例实现???</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#编写node-js" class="sidebar-link" style="padding-left:3rem;">编写node.js</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#编写小程序" class="sidebar-link" style="padding-left:3rem;">编写小程序</a></li><li class="sidebar-sub-header"><a href="/study/frontEnd/wechat/#框架" class="sidebar-link">框架？？？</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>账号： fahaxiki_lz@qq.com</p> <p>e363d743d49592d98b1227d72b1bcd87</p> <h1 id="坑"><a href="#坑" class="header-anchor">#</a> 坑</h1> <blockquote><p>在你写页面时，看到page怎么都不显示东西，可能时在js文件中没有写data，直接写数据了</p></blockquote> <h1 id="需要全局配置的"><a href="#需要全局配置的" class="header-anchor">#</a> 需要全局配置的</h1> <blockquote><ol><li><p>背景音乐API —— app.json</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>'requireBackgroundModes'<span class="token operator">:</span><span class="token punctuation">[</span>'audio'<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>腾讯视频插件 —— app.json</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// app.json</span>
<span class="token punctuation">{</span>
   <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;player&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0.0&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;provider&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wxa75efa648b60994b&quot;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>定位自己的位置 —— app.json</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>  <span class="token property">&quot;permission&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;scope.userLocation&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;你的位置信息将用于小程序位置接口的效果展示&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>获取订阅消息权限 —— app.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token operator">...</span>
	<span class="token literal-property property">globalData</span><span class="token operator">:</span><span class="token punctuation">{</span>
	  <span class="token literal-property property">hasSubscribeMessage</span><span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol></blockquote> <h1 id="this指向问题"><a href="#this指向问题" class="header-anchor">#</a> this指向问题</h1> <blockquote><ul><li>普通函数：this指向当前组件</li> <li>箭头函数：this是undefined</li></ul></blockquote> <h1 id="入门基础"><a href="#入门基础" class="header-anchor">#</a> 入门基础</h1> <h2 id="项目目录"><a href="#项目目录" class="header-anchor">#</a> 项目目录</h2> <p><img src="/study/assets/img/image-20220224093353009.d0829e66.png" alt="image-20220224093353009"></p> <h2 id="创建项目"><a href="#创建项目" class="header-anchor">#</a> 创建项目</h2> <blockquote><p>创建无模板的项目，新建app.json文件，在该文件中输入以下代码，自动新增一个index页面</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
      <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        	<span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></blockquote> <h2 id="页面组件"><a href="#页面组件" class="header-anchor">#</a> 页面组件</h2> <blockquote><ol><li><code>&lt;view&gt;</code>标签类似<code>&lt;div&gt;</code></li> <li><code>&lt;text&gt;</code>标签类似<code>&lt;p&gt;</code></li> <li><code>&lt;icon&gt;</code>图标文件</li> <li><code>&lt;input&gt;</code>标签type属性：
<ul><li>text：文本输入键盘</li> <li>number：数字输入键盘</li> <li>idcard：身份证输入键盘</li> <li>digit：带小数点的数字键盘</li> <li>input组件显示为空白，因为默认样式没有任何边框</li></ul></li> <li>index.wxml中的代码被包裹在<code>&lt;page&gt;</code>标签中，是一个根标签</li></ol></blockquote> <h2 id="页面样式"><a href="#页面样式" class="header-anchor">#</a> 页面样式</h2> <h3 id="选择器"><a href="#选择器" class="header-anchor">#</a> 选择器</h3> <p><img src="/study/assets/img/image-20220224131449230.d6d68b9e.png" alt="image-20220224131449230"></p> <p><img src="/study/assets/img/image-20220224131505948.c53d436d.png" alt="image-20220224131505948"></p> <h3 id="尺寸单位"><a href="#尺寸单位" class="header-anchor">#</a> 尺寸单位</h3> <blockquote><p>尺寸单位为rpx，rpx规定了任何手机屏幕的宽度都是750rpx</p></blockquote> <h3 id="样式导入"><a href="#样式导入" class="header-anchor">#</a> <strong>样式导入</strong></h3> <blockquote><ul><li><p>在index.wxss中导入test.wxss，<code>@import &quot;test.wxss&quot;</code></p></li> <li><p>app.wxss为全局样式，当全局样式和页面样式冲突时，页面样式优先级更高，会覆盖全局样式</p></li> <li><p>在index.js中引入test.js，<code>var xxx = require(&quot;test.js&quot;)</code></p></li> <li><p>view组件的<code>hover-class</code>属性表示该组件按下时的class样式</p></li></ul></blockquote> <h2 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h2> <h3 id="页面级配置文件-index-json"><a href="#页面级配置文件-index-json" class="header-anchor">#</a> 页面级配置文件(index.json)</h3> <p><img src="/study/assets/img/image-20220224131629470.dbf755c7.png" alt="image-20220224131629470"></p> <blockquote><ul><li>若<strong>将<code>enablePullDownRefresh</code>设为true，页面可以下拉刷新</strong>，<strong>当下拉刷新操作执行时，就会触发下拉刷新事件<code>onPullDownRefresh</code></strong>，在pages/index/index.js文件中可以找到该事件的处理函数。</li> <li><code>onReachBottomDistance</code> 主要用于开发自动加载更多的功能，也就是<strong>当页面中的内容非常长的时候，为了加快加载速度，并不是一次性加载所有的数据，而是先加载一部分数据将页面填满，直到出现滚动条，页面可以向上滚动。当用户上拉时，如果快要到达底部了，就立即加载后面的数据。<strong>因此，</strong><code>onReachBottomDistance</code>的值越大，加载的时机越提前</strong>。<strong>如果达到了给定的值，就会触发上拉触底事件<code>onReachBottom</code></strong>，在pages/index/index.js文件中可以找到该事件的处理函数。</li></ul></blockquote> <h3 id="应用级配置文件-app-json"><a href="#应用级配置文件-app-json" class="header-anchor">#</a> 应用级配置文件(app.json)</h3> <p><img src="/study/assets/img/image-20220227205824392.8cdf11ec.png" alt="image-20220227205824392"></p> <blockquote><ul><li><strong>window的值是一个对象，可以将页面级配置文件配置写在 window 中</strong>，作为应用级配置使用，从而一次设置多个页面，且优先级低于页面级配置</li></ul></blockquote> <h4 id="networktimeout"><a href="#networktimeout" class="header-anchor">#</a> networkTimeout</h4> <p><img src="/study/assets/img/image-20220227210328667.a915ab6d.png" alt="image-20220227210328667"></p> <h4 id="tabbar"><a href="#tabbar" class="header-anchor">#</a> tabBar</h4> <blockquote><p>tabBar对象用于配置页面底部的标签栏</p> <p>在微信小程序中启动页面一定要包含在tabBar中，并且启动页必须是tabBar的list属性中的第一个元素，才能正常显示</p></blockquote> <p><img src="/study/assets/img/image-20220303190319892.930e32a1.png" alt="image-20220303190319892"></p> <blockquote><p>list是一个数组，数组的每一个元素是一个标签按钮对象，通过该对象的属性可以配置标签栏中的每个标签按钮</p> <p><img src="/study/assets/img/image-20220303190359670.5221bfa8.png" alt="image-20220303190359670"></p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
......
<span class="token property">&quot;tabBar&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;selectedColor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#f00&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;list&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;pagePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;邀请函&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;iconPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./pages/assets/images/invite.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;selectedIconPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./pages/assets/images/invite.png&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;pagePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/picture/picture&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;图片&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;iconPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./pages/assets/images/marry.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;selectedIconPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./pages/assets/images/marry.png&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;pagePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/video/video&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;美好时光&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;iconPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./pages/assets/images/video.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;selectedIconPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./pages/assets/images/video.png&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;pagePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/map/map&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;结婚地点&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;iconPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./pages/assets/images/map.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;selectedIconPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./pages/assets/images/map.png&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;pagePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/guest/guest&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;宾客信息&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;iconPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./pages/assets/images/guest.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;selectedIconPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./pages/assets/images/guest.png&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ......
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h2 id="页面逻辑-index-js"><a href="#页面逻辑-index-js" class="header-anchor">#</a> 页面逻辑(index.js)</h2> <blockquote><p><strong>Page()函数用来注册一个页面，该函数的参数是一个对象</strong>，通过该对象可以指定页面的初始数据、生命周期函数、事件处理函数等</p></blockquote> <p><img src="/study/assets/img/image-20220228090901915.60ee307d.png" alt="image-20220228090901915"></p> <h3 id="生命周期回调函数"><a href="#生命周期回调函数" class="header-anchor">#</a> 生命周期回调函数</h3> <blockquote><ul><li><strong>onLoad：页面加载时触发，一个页面只会调用一次 。通过参数options可以获取打开当前页面路径中的参数。</strong></li> <li><strong>onReady：页面初次渲染完成的时候调用。一个页面只会调用一次</strong>，代表页面已经准备妥当，此时可以与视图层进行交互。</li> <li>**onShow：当页面显示时触发。**例如，从后台切入前台时触发。</li> <li>**onHide：当页面隐藏时触发。**例如，从前台切入后台时触发。</li> <li>**onUnload：页面卸载时触发。**例如，使用路由API中的wx.redirectTo()或wx.navigateBack()跳转其他页面时触发。</li></ul> <p><strong>执行顺序为onLoad→onShow→onReady</strong></p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token comment">// 获取应用实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token comment">/**
   * 生命周期
   */</span>

  <span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;页面首次加载&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onReady</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;页面首次渲染完成&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onShow</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;页面显示&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onHide</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;页面隐藏&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="onload"><a href="#onload" class="header-anchor">#</a> onLoad</h4> <blockquote><p><strong>在onLoad函数中，有一个参数options，表示打开当前页面路径中的参数</strong>，它可以在当前页面被其他页面打开的情况下接收一些参数。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token comment">// 获取应用实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 跳转页面测试onLoad</span>
  <span class="token function-variable function">testLoad</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'../logs/logs?name=lz&amp;age=21'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// logs.js</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../utils/util.js'</span><span class="token punctuation">)</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  
  <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token comment">//{name: &quot;lz&quot;, age: &quot;21&quot;}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="onshareappmessage-onshow-onhide"><a href="#onshareappmessage-onshow-onhide" class="header-anchor">#</a> onShareAppMessage /onShow/onHide</h4> <blockquote><ul><li><p>在小程序的导航栏中，页面标题的右边有两个按钮，即“⋯”和“⊙”。单击“⋯”会在底部弹出一个菜单，在菜单中有一项“转发”，<strong>单击转发就会触发<code>onShareAppMessage</code>事件</strong>。</p></li> <li><p>单击“⊙”可以在前台、后台之间切换，通过此按钮可以测试<code>onShow</code>和<code>onHide</code>事件，单击后会弹出一个“查找场景值”的菜单，通过场景值可以感知用户的使用场景，如1001表示“发现栏小程序主入口”。</p></li></ul></blockquote> <h3 id="页面事件处理函数"><a href="#页面事件处理函数" class="header-anchor">#</a> 页面事件处理函数</h3> <blockquote><ul><li><strong><code>onPullDownRefresh</code>需要在配置文件中将 <code>enablePullDownRefresh</code>设为 true 才会有效， 默认不开启</strong></li> <li><strong><code>onReachBottom</code>需要在配置文件中将<code>onReachBottomDistance</code>设置数值才生效</strong></li></ul></blockquote> <h3 id="组件事件处理函数"><a href="#组件事件处理函数" class="header-anchor">#</a> 组件事件处理函数</h3> <blockquote><p><strong><code>bindtap</code>表示当用户点击该组件时，执行相应的事件处理函数</strong></p> <p><strong>通过事件对象e，可以获取<code>type</code>（事件类型）、<code>timestamp</code>（事件生成时的时间戳）、<code>target</code>（触发事件的组件的一些属性值集合  id+dataset）、<code>currentTarget</code>（当前组件的一些属性值集合）、<code>detail</code>（额外的信息）等信息。</strong></p> <p>e中的target/currentTarget和detail相当于js/vue/react中的e.target。前者e.detail返回{value=xxx}， .value可以获得input的value值，后者e.target返回的是元素节点， .value也可以获取input的value值</p></blockquote> <h4 id="target和currenttarget的区别"><a href="#target和currenttarget的区别" class="header-anchor">#</a> target和currentTarget的区别</h4> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>outer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testTarget<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    outer
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>inter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>inter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>父元素outer绑定了testTarget事件，而子元素没有绑定，但由于子元素是父元素的一部分，因此单击子元素也会触发testTarget事件。运行程序测试，当单击outer时，控制台中的输出结果为outer-outer，而单击inner时，控制台中的输出结果为 inner-outer。由此可见，<strong><code>e.target</code> 获取到的是子元素的属性值集合，而<code>e.currentTarget</code>获取到的是父元素的属性值集合。</strong></p></blockquote> <h4 id="常用事件"><a href="#常用事件" class="header-anchor">#</a> 常用事件</h4> <blockquote><p>由于小程序并非运行在浏览器环境中，不能使用BOM和DOM。</p></blockquote> <p><img src="/study/assets/img/image-20220304162729887.8b554429.png" alt="image-20220304162729887"></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">capture-bind:</span>touchstart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testTouchStart<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我跳转，测试touchstart<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">capture-bind:</span>touchmove</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testTouchMove<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我跳转，测试touchmove<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">capture-bind:</span>tap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testTap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我跳转，测试tap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token comment">// 获取应用实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token function-variable function">testTarget</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">testTouchStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;testTouchStart...&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">testTouchMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;testTouchMove&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">testTap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;testTap...&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="事件绑定和冒泡"><a href="#事件绑定和冒泡" class="header-anchor">#</a> 事件绑定和冒泡</h4> <blockquote><p>在为组件绑定事件时，有两种方式，分别是“bind事件类型”和“catch事件类型”。bind方式在前面已经用过，如bindtap，它的特点是不会阻止冒泡事件向上冒泡，而**<code>catch</code>可以阻止冒泡事件向上冒泡。**</p></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>outerTap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    　outer3
    　　<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">catchtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>middleTap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>　　
       middle5
      　　 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>innerTap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              inner
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
      　<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>如果单击inner，会先后触发innerTap和middleTap，由于middleTap使用catch阻止了事件冒泡，因此不会执行outerTap。同理，如果单击middle，则只会触发middleTap。如果单击outer，则只会触发outerTap。</p></blockquote> <h2 id="注册程序-app-js"><a href="#注册程序-app-js" class="header-anchor">#</a> 注册程序（app.js）</h2> <blockquote><p>**若要在小程序启动、显示、隐藏时执行某些操作，可以通过 App()函数来实现。**App()函数用于注册小程序，它接收一个对象参数，通过参数指定小程序的生命周期回调等。<strong>App()函数必须在app.js中调用，且只能调用一次，不然会出现无法预期的后果。</strong></p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 生命周期回调————监听小程序初始化</span>
  <span class="token comment">// 小程序初始化完成时触发（全局只触发一次）</span>
  <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onLaunch...&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 生命周期回调————监听小程序显示</span>
  <span class="token comment">// 小程序启动，或从后台进入前台显示时触发</span>
  <span class="token function">onShow</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onshow...&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 生命周期回调————监听小程序隐蔽</span>
  <span class="token comment">// 小程序从前台进入后台时触发</span>
  <span class="token function">onHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onhide...&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 错误监听函数</span>
  <span class="token comment">// 小程序发生脚本错误，或者API调用失败时触发</span>
  <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error...&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 页面不存在监听函数</span>
  <span class="token comment">// 小程序要打开的页面不存在时触发</span>
  <span class="token function">onPageNotFound</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onpagenotfound...&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><img src="/study/assets/img/image-20220228112621919.c5fa1c44.png" alt="image-20220228112621919"></p> <blockquote><ul><li>path：打开小程序的路径，一般情况下是app.json中的第1个路径，也可以通过自定义编译条件指定启动页面，如图2-17所示。</li> <li>query：打开小程序的 query，一般情况下是空对象，也可以通过自定义编译条件指定启动参数</li> <li>scene：打开小程序的场景值，一般情况下是1001，也可以通过自定义编译条件指定进入场景</li> <li>shareTicket：当小程序被转发出去时（如转发到群聊），如果此转发卡片被其他用户打开，可以获取到shareTicket（如群的标识）。通常搭配wx.showShareMenu()使用，并且需要在该方法的参数对象中设置withShareTicket为true。</li> <li>referrerInfo：当场景为从另一个小程序、公众号或 APP 打开时，可以通过它获取来源于小程序、公众号的AppId等，scene为1037或1038时支持传递附加数据。</li></ul></blockquote> <blockquote><p><strong>利用App()函数还可以保存一些在所有页面中共享的数据。getApp()函数用于获取小程序App实例</strong>，获取后即可访问在app.js中定义的属性和方法。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token comment">// 获取应用实例</span>
<span class="token comment">//const app = getApp()//放这里获取是全局的    </span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">onReady</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//放这里只能在这个函数中使用    </span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;页面首次渲染完成&quot;</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>num<span class="token punctuation">)</span>
        app<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="案例1-实现比较功能"><a href="#案例1-实现比较功能" class="header-anchor">#</a> 案例1：实现比较功能</h2> <h3 id="为两个input绑定不同事件处理函数"><a href="#为两个input绑定不同事件处理函数" class="header-anchor">#</a> 为两个input绑定不同事件处理函数</h3> <blockquote><ul><li><p><strong><code>bindchange</code>事件，当数据变化时触发</strong></p></li> <li><p><strong><code>e.detail.value</code>用于获取输入框的内容，不可以使用<code>e.target.value</code></strong></p> <ul><li><p><strong><code>e.target</code>只有id和dataset</strong></p> <p><img src="/study/assets/img/image-20220228130423937.1582b435.png" alt="image-20220228130423937"></p></li></ul></li> <li><p><code>Number()</code>用于将字符串转为数字类型</p></li> <li><p><strong>js中的数据用<code>this.setData({result:xxx})</code>显示在页面上，在WXML中使用双大括号<code></code>可以实现数据绑定</strong></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testFn1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testFn2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compare<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击比较<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>比较结果{{result}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    data：<span class="token punctuation">{</span>
    	<span class="token literal-property property">num1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    	<span class="token literal-property property">num2</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    	<span class="token literal-property property">result</span><span class="token operator">:</span><span class="token string">''</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">testFn1</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     	<span class="token keyword">this</span><span class="token punctuation">.</span>num1 <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">testFn2</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     	<span class="token keyword">this</span><span class="token punctuation">.</span>num2 <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">compare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num1 <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num2<span class="token punctuation">)</span><span class="token punctuation">{</span>
            str <span class="token operator">=</span> <span class="token string">&quot;第一个数大&quot;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num1　<span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num2<span class="token punctuation">)</span><span class="token punctuation">{</span>
            str <span class="token operator">=</span> <span class="token string">&quot;第二个数大&quot;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            str <span class="token operator">=</span> <span class="token string">&quot;一样大&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">result</span><span class="token operator">:</span>str<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li> <li><p><strong>如果想要更改该页面中的<code></code>的值，不能通过直接赋值的方式来实现，而是需要通过<code>this.setData()</code>方法来实现</strong></p></li></ul></blockquote> <h3 id="为两个input绑定相同事件处理函数"><a href="#为两个input绑定相同事件处理函数" class="header-anchor">#</a> 为两个input绑定相同事件处理函数</h3> <blockquote><ul><li><p>为多个input组件绑定相同事件处理函数，然后再为不同的input组件设置不同的id或者dataset</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testFn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testFn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compare<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击比较<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>比较结果{{result}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">num1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">num2</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">result</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
    <span class="token function">change</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">compare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num1 <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num2<span class="token punctuation">)</span><span class="token punctuation">{</span>
            tr <span class="token operator">=</span> <span class="token string">&quot;第一个数大&quot;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num1　<span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num2<span class="token punctuation">)</span><span class="token punctuation">{</span>
            str <span class="token operator">=</span> <span class="token string">&quot;第二个数大&quot;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            str <span class="token operator">=</span> <span class="token string">&quot;一样大&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">result</span><span class="token operator">:</span>str<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong><span style="color:red;">注意：<code>this[e.currentarget.id]</code>是ES7中的对象[ ]语法</span></strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'lz'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">21</span> <span class="token punctuation">}</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p>使用dataset (data-xxx)</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testFn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“num1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testFn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">num1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">num2</span><span class="token operator">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
    <span class="token function">change</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>value
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul></li></ul></blockquote> <h3 id="直接在页面上比较-三元运算符"><a href="#直接在页面上比较-三元运算符" class="header-anchor">#</a> 直接在页面上比较（三元运算符）</h3> <blockquote><ul><li><p><strong>在WXML的中可以写js表达式</strong>，同样可以直接在里面写逻辑，例如三元运算符</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testFn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testFn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compare<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击比较<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>比较结果{{num1&gt;num2?&quot;第一个数大&quot;:(num1&lt;num2?&quot;第二个数大&quot;:&quot;一样大&quot;)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">num1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">num2</span><span class="token operator">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span>
   
    <span class="token function">change</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul></blockquote> <h3 id="通过条件渲染显示不同结果"><a href="#通过条件渲染显示不同结果" class="header-anchor">#</a> 通过条件渲染显示不同结果</h3> <blockquote><ul><li><p><strong>通过<code>wx:if</code>属性判断哪一个标签会在WXML结构中出现（而不是利用样式控制标签的显示或隐藏）</strong>，如果“”中的运算结果为true则出现，运算结果为false则不会出现</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testFn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testFn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>compare<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击比较<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{num1 &gt; num2}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>比较结果：第1个数大<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name"><span class="token namespace">wx:</span>elif</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{num1 &lt; num2}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>比较结果：第2个数大<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name"><span class="token namespace">wx:</span>else</span><span class="token punctuation">&gt;</span></span>比较结果：两数相等<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>把比较结果的&lt;text&gt;标签换成&lt;block&gt;标签也可，<strong>&lt;block&gt;标签并不是一个组件，它仅仅是一个包装元素，不会在页面中做任何渲染，只接收控制属性</strong></p></li></ul></blockquote> <h3 id="通过表单获取input组件的值"><a href="#通过表单获取input组件的值" class="header-anchor">#</a> 通过表单获取input组件的值</h3> <blockquote><ul><li><p><strong>form组件的<code>bindsubmit</code>属性用于绑定表单提交事件。</strong></p> <ul><li>在表单中，为两个input组件加上了name属性**，表单提交时就会自动收集带有name属性的组件的值，收集成对象<code>{name:value}</code>**</li></ul></li> <li><p><strong>比较按钮添加了<code>form-type</code>属性，值为submit表示该按钮用于提交表单</strong></p></li> <li><p>按钮设为reset表示重置表单。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">bindsubmit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>formCompare<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    　<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
      　 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>请输入第1个数字：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>　
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>　　
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>　
    　<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>　
      　 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>请输入第2个数字：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>　
      　 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>　
      　<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>　
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">form-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>比较<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>　
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>比较结果：{{result}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    dataL<span class="token punctuation">{</span>
    	<span class="token literal-property property">num1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    	<span class="token literal-property property">num2</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    	<span class="token literal-property property">result</span><span class="token operator">:</span><span class="token string">''</span>
	<span class="token punctuation">}</span>
    <span class="token function">formCompare</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>num1 <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token punctuation">.</span>num1<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>num2 <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token punctuation">.</span>num2
    
    	<span class="token keyword">if</span><span class="token punctuation">(</span>xxxx<span class="token punctuation">)</span><span class="token punctuation">{</span>
           str <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>xxxx<span class="token punctuation">)</span><span class="token punctuation">{</span>
           str <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span>      
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
          str <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span>  
        <span class="token punctuation">}</span>
    	
    	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">result</span><span class="token operator">:</span>str<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li></ul></blockquote> <h2 id="案例2-调查问卷"><a href="#案例2-调查问卷" class="header-anchor">#</a> 案例2：调查问卷</h2> <blockquote><p><strong><code>&lt;radio-group&gt;</code>标签表示将其包裹的所有<code>&lt;radio&gt;</code>标签当成一个单选框组，组内只有一个&lt;radio&gt;标签可以被选中。</strong></p> <p><strong><code>&lt;checkbox-group&gt;</code>标签表示将其包裹的所有<code>&lt;checkbox&gt;</code>标签当成一个复选框组。</strong></p> <p>&lt;label&gt;标签的作用类似于 HTML 中的同名标签，用于单击文本时也可以选中对应的单选或复选框。</p> <p><strong>在<code>&lt;checkbox&gt;</code>和<code>&lt;checkbox-group&gt;</code>标签中，value属性表示该项选中时提交的值</strong>，checked属性表示该项为选中状态。</p></blockquote> <h3 id="获取表单数据"><a href="#获取表单数据" class="header-anchor">#</a> 获取表单数据</h3> <blockquote><ul><li><strong><code>wx:for</code>渲染列表，需要一个唯一标识<code>wx:key</code>，可以使用关键字<code>*this</code>表示将每一项本身作为唯一标识</strong></li></ul></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>page</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">bindsubmit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submitForm<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{username}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>性别<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>radio-group</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>radio</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{gender}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*this<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.value}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.checked}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>radio</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>radio-group</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>major<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>专业技能<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkbox-group</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>major<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>major<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checkbox</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{major}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*this<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.value}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.value}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkbox</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>checkbox-group</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>您的意见<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">form-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>page</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// pages/questionnaire/index.js</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token punctuation">}</span>
	<span class="token operator">...</span><span class="token operator">...</span>
	<span class="token function">submitForm</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>datail<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
		<span class="token comment">/**
         * 将表单中的name和value封装成了对象
         * {username: &quot;&quot;, gender: &quot;&quot;, major: Array(0), message: &quot;&quot;}
         */</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="服务器交互"><a href="#服务器交互" class="header-anchor">#</a> 服务器交互</h3> <blockquote><p>**将用户提交的表单提交到服务器，可以通过小程序中的网络API <code>wx.request()</code>来实现。**需要注意的是，对于正式上线的项目，小程序要求服务器域名必须在小程序管理后台中添加，域名必须经过ICP备案，且只支持HTTPS和WSS协议。</p> <p>注意：需要把这个勾选上</p> <p><img src="/study/assets/img/image-20220228163744314.0706e593.png" alt="image-20220228163744314"></p> <p>否则会报错<img src="/study/assets/img/image-20220228163718594.dabc304c.png" alt="image-20220228163718594"></p></blockquote> <h4 id="使用node搭建后台"><a href="#使用node搭建后台" class="header-anchor">#</a> 使用node搭建后台</h4> <blockquote><ol><li>初始化项目，将会自动创建package.json配置文件<code>npm init –y</code></li> <li>安装Express框架，用于快速搭建HTTP服务器<code>npm install express --save</code></li> <li>安装nodemon监控文件修改<code>npm install nodemon -g</code></li></ol></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//node/index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;body-parser&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;啊吧啊吧！！！&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// pages/questionnaire/index.js</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">submitForm</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3000/'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
            <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;啊吧啊吧，成功了！！！&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><blockquote><ul><li><strong>method 表示请求方式，默认为GET</strong></li> <li><strong>url 表示服务器接口地址</strong></li> <li><strong>data 表示请求的参数</strong></li> <li><strong>success表示接口调用成功的回调函数，其参数res表示服务器响应信息</strong></li> <li><strong>fail表示接口调用失败的回调函数，其参数error表示错误信息</strong></li></ul></blockquote> <h1 id="音乐小程序项目"><a href="#音乐小程序项目" class="header-anchor">#</a> 音乐小程序项目</h1> <h2 id="swiper组件"><a href="#swiper组件" class="header-anchor">#</a> swiper组件</h2> <blockquote><ul><li>swiper组件是滑块视图容器，经常<strong>用于实现轮播图，也可用于实现标签页切换。</strong></li> <li><strong><code>&lt;swiper&gt;</code>标签是外层容器，里面有<code>&lt;swiper-item&gt;</code>标签</strong>，在初始状态下只显示第1项，向左滑动显示第2项，再向右滑动可以返回第1项。</li> <li>微信小程序并没有严格规定<code>&lt;swiper-item&gt;</code>标签内可以嵌套哪些组件，如果放入image 组件，就实现了轮播图的效果；如果放入一块页面内容，就实现标签页切换的效果了。</li> <li><strong><code>e.detail.current</code>可以获得<code>&lt;swiper-item&gt;</code>的索引，索引是从0开始的</strong></li> <li>通过改变 current 的值，可以切换当前显示哪一项<code>&lt;swiper-item&gt;</code>，其值是一个从0开始的索引，对应<code>&lt;swiper-item&gt;</code>的顺序，如第1个<code>&lt;swiper-item&gt;</code>的索引为0，第2个<code>&lt;swiper-item&gt;</code>的索引为1。</li></ul></blockquote> <p><img src="/study/assets/img/image-20220301200839380.d5b21fdb.png" alt="image-20220301200839380"></p> <p><img src="/study/assets/img/image-20220301200856186.2577d5a7.png" alt="image-20220301200856186"></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 显示第二页 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper</span> <span class="token attr-name">current</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper-item</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper-item</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper-item</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper-item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 显示第二页 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper</span> <span class="token attr-name">current-item-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper-item</span> <span class="token attr-name">item-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper-item</span> <span class="token attr-name">item-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper-item</span> <span class="token attr-name">item-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper-item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="include代码引用"><a href="#include代码引用" class="header-anchor">#</a> include代码引用</h2> <blockquote><ul><li><p>在 wxml 文件中可以使用<code>&lt;include&gt;</code>标签引用其他文件中的代码，相当于把引用的代码复制到、<code>&lt;include&gt;</code>标签的位置。</p> <ul><li>当一个 wxml 页面中的代码过多时，会给代码的维护带来麻烦，<strong>利用<code>&lt;include&gt;</code>将代码拆分到多个文件中，就可以更方便地查找代码。</strong></li> <li>当多个wxml页面中有相同的部分时，可以<strong>将这些公共部分抽取出来，保存到一个单独的wxml文件中，然后在用到的地方通过<code>&lt;include&gt;</code>引入。</strong></li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header.wxml<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></blockquote> <h2 id="scroll-view组件"><a href="#scroll-view组件" class="header-anchor">#</a> scroll-view组件</h2> <blockquote><ul><li>使用<code>scroll-view</code>组件，超出了显示区域的内容使用阴影表示，当页面向上滚动时，阴影区域的内容就会显示出来。</li> <li><strong><code>scroll-view</code>组件用于实现可滚动视图区域，小区域滚动。</strong></li> <li>设置<code>scroll-y</code>属性即可实现纵向滚动。需要注意的是，<strong>纵向滚动需要在样式中为<code>&lt;scroll-view&gt;</code>设置一个固定高度，否则它会被子元素撑大。</strong></li> <li><code>scroll-view</code>组件设置了允许横向和纵向滚动，当发生滚动时就会执行事件处理函数scroll。<strong>在<code>scroll-view</code>标签内有一个<code>&lt;view&gt;</code>标签，且<code>&lt;view&gt;</code>标签的宽度和高度都大于<code>scroll-view</code>标签，从而使滚动条出现。</strong></li></ul></blockquote> <p><img src="/study/assets/img/image-20220302102931130.26a302ea.png" alt="image-20220302102931130"></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scroll-view</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">scroll-y</span> <span class="token attr-name">scroll-x</span> <span class="token attr-name">bindscroll</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scroll-view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">scroll</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/study/assets/img/image-20220302103206987.757de66d.png" alt="image-20220302103206987"></p> <blockquote><ul><li>scrollLeft：横向滚动条左侧到视图左边的距离。</li> <li>scrollTop：纵向滚动条上端到视图顶部的距离。</li> <li>scrollHeight：纵向滚动条在Y轴上最大滚动距离。</li> <li>scrollWidth：横向滚动条在X轴上最大的滚动距离。</li> <li>deltaX：横向滚动条的滚动状态。</li> <li>deltaY：纵向滚动条的滚动状态。</li></ul></blockquote> <h3 id="隐藏滚动条"><a href="#隐藏滚动条" class="header-anchor">#</a> 隐藏滚动条</h3> <blockquote><div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">::-webkit-scrollbar</span> <span class="token punctuation">{</span>
 <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
 <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></blockquote> <h2 id="image组件"><a href="#image组件" class="header-anchor">#</a> image组件</h2> <blockquote><ul><li><strong>image组件的默认宽高为300px×225px</strong>，且<strong>image组件中的添加<code>show-menu-by-longpress</code>属性支持二维码图片长按识别</strong>，</li> <li><strong>使用<code>wx.previewImage()</code>可以实现在新页面中全屏预览图片。预览的过程中用户可以进行保存图片、发送给朋友等操作。</strong></li></ul></blockquote> <p><img src="/study/assets/img/image-20220302104829847.c455f1dc.png" alt="image-20220302104829847"></p> <p><img src="/study/assets/img/image-20220302104842156.42e537e7.png" alt="image-20220302104842156"></p> <blockquote><p>缩放模式</p></blockquote> <p><img src="/study/assets/img/image-20220302110211320.36c14386.png" alt="image-20220302110211320"></p> <blockquote><p>裁剪模式</p></blockquote> <p><img src="/study/assets/img/image-20220302110224981.e7d5de0f.png" alt="image-20220302110224981"></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 缩放 --&gt;</span>
<span class="token comment">&lt;!-- scaleToFill：不保持纵横比，拉伸宽高
     aspectFit：保持纵横比，长边占满，短边显示
     aspectFill：保持纵横比，短边占满，长边多的截取
     withFix：保持纵横比，宽度不变，高度自动变化 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span> <span class="token property">border</span><span class="token punctuation">:</span> 1px solid black<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>widthFix<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./images/bk.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>


<span class="token comment">&lt;!-- 截取 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span> <span class="token property">border</span><span class="token punctuation">:</span> 1px solid black<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./images/bk.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="音频api"><a href="#音频api" class="header-anchor">#</a> 音频API</h2> <blockquote><ul><li><p>微信小程序提供了<strong>播放音频的API <code>wx.createInnerAudioContext()</code></strong>，掌握这个API的使用方法是实现音乐播放功能的关键。在使用音频API时，需要通过如下代码创建一个实例。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> audioCtx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createInnerAudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>onTimeUpdate(function callback)</code>：**监听音频播放进度更新事件，获取音乐状态信息。**当用户开始播放视频，或者重新定位视频播放位置时，会执行显示当前播放位置的函数。</p></li></ul></blockquote> <p><img src="/study/assets/img/image-20220302163543530.9ffa482d.png" alt="image-20220302163543530"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">onReady</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> audioCtx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createInnerAudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// newbody外链地址</span>
        audioCtx<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;http://ws.stream.qqmusic.qq.com/C4000033heV13onaLs.m4a?guid=288085782&amp;vkey=8D21D552F7F1A66854E6D224D2195D01385984F88678DBFEF07094791773C1C2AE622C2B7A2A3278A9EE8EA384664A2CF316700873F83C00&amp;uin=&amp;fromtag=66&quot;</span>

        audioCtx<span class="token punctuation">.</span><span class="token function">onPlay</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开始播放&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        audioCtx<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        audioCtx<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="旋转动画"><a href="#旋转动画" class="header-anchor">#</a> 旋转动画</h3> <blockquote><ul><li><p><strong><code>animation-play-state</code>控制旋转动画的状态</strong></p></li> <li><p><strong>旋转动画用rotate，单位用deg，0-360</strong></p></li> <li><p><strong>infinite用于循环播放</strong></p></li></ul></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token selector">animation-play-state:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{play.coverImgUrl}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@keyframes</span> rotateImage</span> <span class="token punctuation">{</span>
    <span class="token selector">from</span> <span class="token punctuation">{</span>
        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token selector">to</span> <span class="token punctuation">{</span>
        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="slider组件"><a href="#slider组件" class="header-anchor">#</a> slider组件</h2> <blockquote><ul><li><strong>slider组件是小程序表单组件中的一种，用于滑动选择某一个值</strong>，在本项目中将用来实现<strong>播放器的进度条</strong>。</li> <li><strong><code>e.detail.value</code>表示当前slider的值。</strong></li></ul></blockquote> <p><img src="/study/assets/img/image-20220302170713868.0dc4b1de.png" alt="image-20220302170713868"></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slider</span> <span class="token attr-name">show-value</span> <span class="token attr-name">bindchanging</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeslider<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slider</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token function">changeslider</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h1 id="婚礼邀请函小程序项目"><a href="#婚礼邀请函小程序项目" class="header-anchor">#</a> 婚礼邀请函小程序项目</h1> <h2 id="背景音乐api"><a href="#背景音乐api" class="header-anchor">#</a> 背景音乐API</h2> <blockquote><ul><li><p><strong>可以使用<code>wx.createInnerAudioContext()</code>接口播放音频</strong>，在小程序中，还有一种专<strong>门用于播放背景音频的<code>wx.getBackgroundAudioManager()</code>接口</strong>，其特点在于<strong>小程序切入后台时，如果音频处于播放状态，可以继续播放。<strong>为了实现这个效果，需要先在</strong>app.json 中添加如下配置</strong>，添加后在开发版中会直接生效，正式版还需通过审核。<strong>方法和属性和<code>createInnerAudioContext</code>相似</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;requiredBackgroundModes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;audio&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>创建<code>BackgroundAudioManager</code>实例对象，<strong>当设置了新的src时，会自动开始播放</strong>，目前支持的格式有 m4a、aac、mp3、wav。</p></li></ul></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>	<span class="token comment">// 背景音乐初始化</span>
    <span class="token literal-property property">bgm</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token comment">// 音乐路径</span>
    <span class="token literal-property property">music_url</span><span class="token operator">:</span> <span class="token string">&quot;http://ws.stream.qqmusic.qq.com/C400000qSRRR2aLkXf.m4a?guid=918327025&amp;vkey=7BA4F2A3DA58FBBA3299BE1852A3951FE31F9DD4B4FCA26C53F3FED1D70016A1B0DAB75F8F2A01EE9B45BD6552DA60A0BBA6945C26BDE91E&amp;uin=&amp;fromtag=66&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 专辑封面</span>
    <span class="token literal-property property">music_coverImgUrl</span><span class="token operator">:</span> <span class="token string">' '</span><span class="token punctuation">,</span>
    <span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 设置唱片背景音乐</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bgm <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getBackgroundAudioManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 标题</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bgm<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'marry me'</span>
        <span class="token comment">// 专辑名称</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bgm<span class="token punctuation">.</span>epname <span class="token operator">=</span> <span class="token string">'wedding'</span>
        <span class="token comment">// 艺术家</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bgm<span class="token punctuation">.</span>singer <span class="token operator">=</span> <span class="token string">'singer'</span>
        <span class="token comment">// 专辑封面</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bgm<span class="token punctuation">.</span>coverImgUrl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coverImgUrl
        <span class="token comment">// 音频进入可以播放状态的事件</span>
        <span class="token comment">// this.bgm.onCanplay(() =&gt; {</span>
        <span class="token comment">//     // 不自动播放</span>
        <span class="token comment">//     this.bgm.pause()</span>
        <span class="token comment">// })</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bgm<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>music_url
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><blockquote><p>在播放状态下，微信开发者工具会弹出一个播放控制的对话框</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAbsAAABXCAYAAACdmOtTAAAN9ElEQVR4nO3dX2xTZ57G8W+m03i2IckSG5Ya02lIit1AoqFJJAIiakhCqVCxRUUXbXqTSLkz13MFWoWrucZ3kUCq6hVwgU4ioVAwIAGmHSVDt4ZGdgeaQlxLLXFSMJmOYdnshe3E+W+DKeHs87nKsc/7nte+4OH3nvc9LqqqqppCRETExH73sgcgIiLyoinsRETE9BR2IiJiego7ERExPYWdiIiYnsJORERMT2EnIiKmp7ATERHTU9iJiIjpKexERMT0FHYiImJ6CjsRETE9hZ2IiJiewk5ERExPYSciIqansBMREdNT2ImIiOkp7ERExPQUdiIiYnoKOxERMT2FnYiImJ7CTkRETE9hJyIipqewExER01PYiYiI6SnsRETE9BR2IiJiei807Lw+A8Pfg/tFXkRERGQZv3+RnfvOh2jqqqP9EPQdy6HBIR/GtnFOdByhb18P/q46ShY7NxrA4/UBXnxGE+PHOzjSv/Cp7qN+OmtL5rRb4JqzWi3fr4iIvBoKE3bLBFNJq4HROufFyVA6YLJCBaCkjk7DoDMawOPxpM5dNJDm8uIz2nAs8M7kzROcpp36Qd/sN455CTgNPjnqpu9wVu+HXDgm73BBQSci8sorTNj1H6EjEwqHfBjO8OzqCVKB+O9wernAmg7BGV6ng8nvLywTdAA+LtxsonP1l/Orvj/6MFpXExpcoNX5E/Ne8zodMBHO4ZoiIpIvq9XKxo0bsdvtWCwWrFYrAPF4nGQySSwW4/vvvycejxfkeoWfxjwWJmq04Tvkwzs9denF11XHxM35obIUr8+gLVOmOToxjM70QZSA5wJr/Z3UpctJR5eBsTuAx9tB3yEf/qNuOg5nenLTs201oekpSTc9WW0z2rpS/UcvBkiVh20YRtuscyZvnqDjcG4RGD2+kzV/CWGJPJj3XtJZzv0/1+HouppTXyIiZmC322lsbMRut/PDDz8wMjLC2NjYrHNsNhvr16+noaGBeDzOtWvXiMViz3Xdoqqqqqnn6mGR4MjF5M0oE7WOBacdmQwRmqijamJOuOzrwd9VwZceL6nacaZ6+1tj1r25Ja+b6dOLz3ARnu4r/YmO+umsnSAw/bqbHv8ncCq/+3cKOxGRGbt27cLpdDI4OMjNmzdJJpNLnm+xWKitraWxsZFwOMz169eXbbOYAlR2fRzpeDGTfV6fQVXqr9n39RZQsdvPJxOn8Xj6ptu6IgFobYIoOBzZ4bXkVWlPB+bafUA/wAYqSiYI6/6diEjeLBYLbrebqakp/H4/Dx8+zKldMplkaGiI7777jg8++AC3201fX98zBV4BpzEXXxwyz9wVkWnuo/6s+225cNPjT11zMlMBHvJhtDqIXvTgPebF1wrj5zvw9nvxGQZG9vX3rWU1DtoMg8xkZTQaxRENEKCNpkY39PelF6uMc2GZ0dz/cx3l/3WH4tHJee893lDCg/+oYs1fQjl+NhGRV18m6BKJBJcuXXqmoHr48CH9/f3s2rXrmQOvwPfsJrPuiy0sFWjZr6RCkoueZcNkTk/0+Dup+CpAtLWJ8cEN+AxjOmwdWStAHV0GRldmiCFOzArT6HTFl6oGvXiOgftoE20b63HTx4YcF8gkneVMvbHwVzr1xu9JOsvz+oQiIq+6HTt2MDU1xcDAwHP1k0wmGRgY4MCBA7S0tHDu3Lm82r/0J6i4jzbhmAxx4Vj2a34Mw4dryZZ9HOnwZC2C8eH1eAhEIXrRg8fjweMJEGWS0PH08fEQ82quyXFGU1dlbVYI9x3+kmhJHe0+H22OSe4Mal2miEg+XC4XlZWV9PcX7h5Qf38/69evx+VaOiHmKnBlV0JddhW1mGjmDy/ttRA6nt5qcPg09f5OOh0QvdhB2GnQBLP3vO1bfhSOOfv65lZ20/5YQcms7QWTjN/N/J3exlDrYPLmCW0sFxHJU0NDA8Fg8JkXlSwkmUwSDAapr69nZGQk575f8jSmD68nM6U4c88vdb8NwINvXw/+LgfgoNPwU3+8gw7P0qOYaT/nKSjpvX7pkdCzzUH0K2/6eAMVJTA+3cvMQpWS9HSmajsRkdxkKq9wOLzoOcXFxTQ2NvLNN9/w6NGjnPsOh8M0NDTgdDoJhXJbB/HSpzEhM23ZhoMoAc/M1KT7qB+jqw5unkhPQ96hqsvA8Hnn9DDBz1kB62g1MAwj3We62jQMjOynvBxqp46s6dN9a5nO4EM+DKON1enrBibq6DT89ORQVYqICDkFUUVFBVVVVXz00Ue8++67efU/NDSU11TmS57GzOzRixLwdMxsC8g8fiwawOPJWkySflKL12dg+FyEVjtS+/smQ7MWt8xUdnNMV3bpTeanvPSlV2+mGgb4W6Mfo3aCgMczPR6fN1NhGvgbc99ULiLy/5Xdbufy5cs5nfv666/T2NjIunXrCAaDPH78eNk2sViMlpYWLBZLTlOZBdhUnpHbg5Pz317w6njgfotVwZ95beyf846f2v7Aox1rKe+7BzDvWETETD799FM+//zzJc9Zt24du3fvnvXakydPCAaD3Lu3/L+NBw4cIBgM5vR0lQKGnYiISEpmP9xSFgq7jNHR0WWrPLfbTSQSWfK+YMaKuGcnIiKSbcOGDXz88cdUVFQsed6qVaty6k9hJyIir6Rc7u1lvNAfbxUREXkWuUxjFhcX57xlQWEnIiIFl+v04lz5LFApLi7O+aHSCjsRESm4srIyysrKcg4jgJ9++onLly/nND1ZVlaGzWbL+cdddc9OREQKLhaL8fbbb+d07pMnTxgcHOSLL77I+T6c3W5nbGzsZT0uTEREBEZGRqitrV3yKSrj4+OMjo4yODiY1+PCAGpra4lEIjmfr8pOREQKLhQKUVRUtOQjvR4/fszly5fzDjqXy0VZWdlKCTsne7u72ZvfrzCIiIhJDA0NsX37diwWS8H6tFgs1NfX5/1rCnqCioiIvDC7du3CZrNx+vTpgvR34MABHj16lPePwWoaU0REXphgMMjU1BR79ux5rgrPYrHQ0tICwKVLl/JuX7DKzvlhN83pHw9IfHuGk9dt7O3eyi/GSYL3nam/r46yYWcNpQDRK/QORBZsH7t6BXZWc7v3LBHAuv0g+zeXpt6cbpfu89sENZvt6WvmtgQ1+5pbHwyT2FyDfbpv2NvdnHWcGuOsMRDjSnpss/pIDHPmIrR7/pXRb0up2VzKLxPwWix7bM6s72VmLNbtB9lfPspweQ01pUBimDMnw7gO7s86DjLdy7zvO7/PLiLyW7FYLOzbt4+ioiLOnTuX13YESG0z2LNnD1NTU/T39z/Tj8G+VlFR8Z95t5rDuv0ge/7wV3pPnefGjRvcGv0VsLGp/k3+Gb7F6D9sbKrfxMaK+5z9zODajUnebGlm0z9u8Pex+e1/17ifLWUJ7t74O3HXXj51/syZzwyu3bjB5Dv7aV97l1ujb6T6fPw1vafOp6+ZH9s79WyqfsLXvSc5nx7T+/WvzzpOjdHKe1uKuXoqPYZ/e5/mdya5cTs+u49bo/xa8hZbXBspv3+Wz/quMfy/b9LkXMXdW6P8CuDaxvuvDWN8Mzuc3tiwhXery7k/8BnG1bv8y5Zmmpscs463lt3l1uivc76vu5Tv2E/d/6S+SxGRlebp06fcuXMHm81GS0sLRUVFxONxnj59umQ7i8XCe++9R0tLC7FYjEAg8My/el6QrQfx8QS8ZcNKhMXriwTDFzOVSYTb0Wa2VlgBG9s2w7AxU+VFBq5Q3V0NWNnxJzux/z473W9kJEZzpW2mz6FFVuOs2cFBT7qKJMHwnEpqelTffkUka0ylD2Yfp8YYJzgQnBnfSIzmyoX6yIjxdabSCt8mtrMaGxAHnJV2YiNnFx5z9Ov0GOOE7yWoKZ97bFvg+0q9154ep4jISpRMJrl06RLhcJjGxkYaGhoYGRkhFosxNjb7f+o2mw273U5lZSVjY2OcO3cup5/xWUph9tmFz3Km4iD7u7vnTbctZuxBIusowdgCQZRh39lN987s03/ByjJlzP0gJ3uDS5+TD9deunfaZ46jt3NsmArNahdEwk6qHTFu53dfdQGl1Hi6qcl+KZqJUxGRlSsWi9HX14fVaqWyspLKykrq6uooLU2XJokEiUSCH3/8kcHBwZyfkLKcgm0qj18/Se/19L2nD5305vUPeim2NRDJBN4aG6XT7y1WlTmfb8D5cO2l+0+/cKY3XWG69tJduVyjGZGhYbY2OIFq7NHbLFLX5WHmnqGIyKsoHo8Tj8cZGhr6Ta5X8NWY8fEElNuw5twiwu1oKTUNM+HlbMhMP8YJ34Oa1h159Fd41opSeDA2szik0r7k+fPcDzNaXs3eytLFp11zFuF21E7zh79h2IuIvOIKUtnNX6kYJJ5H5RUZOIPt4H66u5tTPVy9QsxRDaQqxivl3ezvnpm0i13t5ezyP0xbMPHrFxjOHl8037njOOF7pex/a5SvlpiuzdXc72upe5IiIrJSN5Wv2cHBVriQw72/V4V1+0HauaAtAiIiL8EK3FRuZUdrDdwLmybowMm2zYmZFZoiIvKbWhG/epC9QRpIbeY2STBkPlvsaq8WlIiIvCQrcxpTRESkgFbgNKaIiEhhKexERMT0FHYiImJ6CjsRETE9hZ2IiJiewk5ERExPYSciIqansBMREdNT2ImIiOkp7ERExPQUdiIiYnoKOxERMT2FnYiImJ7CTkRETE9hJyIipqewExER01PYiYiI6SnsRETE9BR2IiJiego7ERExPYWdiIiY3v8BCWCxXpjnLIQAAAAASUVORK5CYII=" alt="image-20220304084845080"></p></blockquote> <h2 id="背景图片"><a href="#背景图片" class="header-anchor">#</a> 背景图片</h2> <blockquote><ul><li><strong>小程序中不能在WXSS中通过background引入本地图片</strong>，因此使用image组件来引入本地图片。由于小程序的体积有限，在实际开发中，推荐用 URL 的方式引入一些比较占用空间的图片等资源。</li> <li><strong>css中的vh是一种视窗单位，也是相对单位。相对于视窗的高度。视窗被均分为100单位的vh。vh 优势在于能够直接获取高度，而用 % 在没有设置 body 高度的情况下，是无法正确获得可视区域的高度的。</strong></li></ul></blockquote> <h2 id="拨打电话api"><a href="#拨打电话api" class="header-anchor">#</a> 拨打电话API</h2> <blockquote><p><strong>通过调用<code>wx.makePhoneCall()</code>接口实现呼叫功能</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token function">callGroom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">makePhoneCall</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">phoneNumber</span><span class="token operator">:</span> <span class="token string">'18063345001'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></blockquote> <h2 id="视频api"><a href="#视频api" class="header-anchor">#</a> 视频API</h2> <blockquote><p>在小程序中播放视频有两种实现方式，<strong>一种是使用video组件，一种是使用腾讯视频插件</strong></p></blockquote> <h3 id="video组件"><a href="#video组件" class="header-anchor">#</a> video组件</h3> <blockquote><ul><li><strong>video组件常用于视频的播放，其默认宽度为300px，高度为225px，可通过WXSS设置宽度和高度。</strong></li> <li><strong>创建实例需要传入id， <code>wx.createVideoContext(String id)</code>id是video标签中的id</strong></li> <li><strong>video可以设置弹幕，弹幕列表可以设置弹幕文本text，弹幕时间time，弹幕颜色color</strong></li> <li><strong>使用实例的<code>sendDanmu(Object data)</code>方法可以发送弹幕吗，有两个参数String text弹幕文本，String color弹幕颜色</strong></li></ul></blockquote> <blockquote><p>常用属性</p></blockquote> <p><img src="/study/assets/img/image-20220304151959943.f6588e03.png" alt="image-20220304151959943"></p> <blockquote><p>常用方法</p></blockquote> <p><img src="/study/assets/img/image-20220304152254478.75e3d207.png" alt="image-20220304152254478"></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{src}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enable-danmu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">danmu-list</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{danmuList}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">danmu-btn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myVideo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">controls</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindblur</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bindnputDanmu<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bindSendDanmu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击发送弹幕<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 弹幕数据初始化</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">'https://mdn.github.io/learning-area/html/multimedia-and-embedding/video-and-audio-content/rabbit320.mp4'</span><span class="token punctuation">,</span>。
        <span class="token comment">// 设置弹幕的文本，发送弹幕的时间，以及弹幕文字的颜色</span>
        <span class="token literal-property property">danmuList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'新婚快乐'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#f00'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'百年好合'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#f00'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'恭喜恭喜'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#f00'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'真般配啊'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#f00'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'真般配啊'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#f00'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 创建视频实例</span>
    <span class="token literal-property property">videoContext</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//参数为video组件的id值</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>videoContext <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createVideoContext</span><span class="token punctuation">(</span><span class="token string">'myVideo'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 获取输入框弹幕信息</span>
    <span class="token literal-property property">inputDanmu</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token function">bindnputDanmu</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>inputDanmu <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 发送弹幕</span>
    <span class="token function">bindSendDanmu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>videoContext<span class="token punctuation">.</span><span class="token function">sendDanmu</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">//弹幕文本</span>
            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>inputDanmu<span class="token punctuation">,</span>
            <span class="token comment">//弹幕文本颜色</span>
            <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#f00'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h4 id="获取本地视频"><a href="#获取本地视频" class="header-anchor">#</a> 获取本地视频</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token function">bindButtonTap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">,</span> <span class="token string">'camera'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//视频选择的来源,相册和相机</span>
            <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token string">'back'</span><span class="token punctuation">,</span> <span class="token comment">// 默认拉起的是前置（front）或者后置（back）摄像头</span>
            <span class="token literal-property property">maxDuration</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">src</span><span class="token operator">:</span> res<span class="token punctuation">.</span>tempFilePath <span class="token comment">//选定视频的临时路径</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token comment">//错误信息</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="腾讯视频插件"><a href="#腾讯视频插件" class="header-anchor">#</a> 腾讯视频插件</h3> <blockquote><p>小程序中提供了腾讯视频插件来播放视频，其特点是，用户可以将视频上传到<a href="https://v.qq.com/" target="_blank" rel="noopener noreferrer">腾讯视频网站<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，而不需要自己搭建视频服务器。要使用该插件，<strong>首先需要打开“小程序管理后台”，在“设置”-“第三方服务”中添加插件。通过详情中的开发文档可以获取插件的AppID及配置方法</strong></p> <p><img src="/study/assets/img/image-20220304155938029.dde5ef9f.png" alt="image-20220304155938029"></p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// app.json</span>
<span class="token punctuation">{</span>
   <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;player&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0.0&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;provider&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wxa75efa648b60994b&quot;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// page index.json</span>
<span class="token punctuation">{</span>
   <span class="token comment">//...你的其他页面配置</span>
   <span class="token property">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;player-component&quot;</span><span class="token operator">:</span> <span class="token string">&quot;plugin://player/video&quot;</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>例如：<code>https://v.qq.com/x/cover/mzc0020047u9g7v/f09304p818n.html</code>，vid就是f09304p818n</p></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- index.wxml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
   <span class="token comment">&lt;!-- 这里的标签使用的是index.json配置的 --&gt;</span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>player-component</span> <span class="token attr-name">vid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{你想要播放的vid}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">player</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>txv<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>对 腾讯视频插件 实例进行操作，不操作的话不用写</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用requirePlugin()函数引入插件</span>
    <span class="token keyword">const</span> TxvContext <span class="token operator">=</span> <span class="token function">requirePlugin</span><span class="token punctuation">(</span><span class="token string">'player'</span><span class="token punctuation">)</span>
    <span class="token comment">// 调用getTxvContext()方法</span>
    <span class="token keyword">var</span> txvContext <span class="token operator">=</span> TxvContext<span class="token punctuation">.</span><span class="token function">getTxvContext</span><span class="token punctuation">(</span><span class="token string">&quot;txv&quot;</span><span class="token punctuation">)</span>
    txvContext<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    txvContext<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="wxs"><a href="#wxs" class="header-anchor">#</a> WXS</h3> <h4 id="模块"><a href="#模块" class="header-anchor">#</a> 模块</h4> <blockquote><ul><li>WXS 代码可以编写在 wxml 文件中的 <code>&lt;wxs&gt;</code> 标签内，或以 <code>.wxs</code> 为后缀名的文件内。</li> <li><strong>每一个 <code>.wxs</code> 文件和 <code>&lt;wxs&gt;</code> 标签都是一个单独的模块。</strong></li> <li>每个模块都有自己独立的作用域。即在一个模块里面定义的变量与函数，默认为私有的，对其他模块不可见。</li> <li><strong>一个模块要想对外暴露其内部的私有变量与函数，只能通过 <code>module.exports</code> 实现。</strong></li> <li>重复模块名则按照先后顺序覆盖（后者覆盖前者）。不同文件之间的 wxs 模块名不会相互覆盖。</li></ul></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /pages/tools.wxs</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">&quot;'hello world' from tools.wxs&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">FOO</span><span class="token operator">:</span> foo<span class="token punctuation">,</span>
  <span class="token literal-property property">bar</span><span class="token operator">:</span> bar<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">&quot;some msg&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- page/index/index.wxml --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wxs</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./../tools.wxs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">module</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tools<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span> {{tools.msg}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span> {{tools.bar(tools.FOO)}} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="require函数"><a href="#require函数" class="header-anchor">#</a> require函数</h4> <blockquote><p>在<code>.wxs</code>模块中引用其他 <code>wxs</code> 文件模块，可以使用 <code>require</code> 函数。</p> <p>引用的时候，要注意如下几点：</p> <ul><li><strong>只能引用 <code>.wxs</code> 文件模块，且必须使用相对路径。</strong></li> <li><code>wxs</code> 模块均为单例，<code>wxs</code> 模块在第一次被引用时，会自动初始化为单例对象。多个页面，多个地方，多次引用，使用的都是同一个 <code>wxs</code> 模块对象。</li> <li>如果一个 <code>wxs</code> 模块在定义之后，一直没有被引用，则该模块不会被解析与运行。</li></ul></blockquote> <h4 id="wxs增强页面功能"><a href="#wxs增强页面功能" class="header-anchor">#</a> wxs增强页面功能</h4> <blockquote><p>在实际开发中，经常会遇到这样的情况：页面中的data数据是从服务器端获取的，服务器返回的数据可能不适合直接显示到页面中，需要对数据进行转换后才能显示。假设在本项目中，视频列表数据是从服务器获取的，服务器返回的create_time 是一个时间戳</p> <p>针对这种情况，可以在WXML文件中通过WXS（WeiXin Script）嵌入代码。WXS是小程序的一套脚本语言，语法和 JavaScript 类似，但又存在少量的差异</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 项目使用video组件</span>
        <span class="token literal-property property">MoveList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token literal-property property">create_time</span><span class="token operator">:</span> <span class="token string">'1532519754589'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'在一起的第一天'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">'https://mdn.github.io/learning-area/html/multimedia-and-embedding/video-and-audio-content/rabbit320.mp4'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">create_time</span><span class="token operator">:</span> <span class="token string">'1532519754589'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'在一起的第二天'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">'https://mdn.github.io/learning-area/html/multimedia-and-embedding/video-and-audio-content/rabbit320.mp4'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">create_time</span><span class="token operator">:</span> <span class="token string">'1532519754589'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'在一起的第三天'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">'https://mdn.github.io/learning-area/html/multimedia-and-embedding/video-and-audio-content/rabbit320.mp4'</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//date.wxs</span>
<span class="token keyword">var</span> <span class="token function-variable function">dateTime</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dateTime</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token function">getDate</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">)</span>
    <span class="token keyword">var</span> y <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> m <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">var</span> d <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> h <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> s <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> y <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> m <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> d <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> h <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> s
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">formatDateTime</span><span class="token operator">:</span> dateTime
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>video<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{MoveList}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*this<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{date.formatDateTime(item.create_time)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{item.title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">controls</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.src}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wxs</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./date.wxs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">module</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>date<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wxs</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="map组件"><a href="#map组件" class="header-anchor">#</a> map组件</h2> <blockquote><p>map常用属性：</p> <p><img src="/study/assets/img/image-20220305144514793.7699a775.png" alt="image-20220305144514793"></p></blockquote> <blockquote><p>markers、polyline、circles的值都是由对象组成的数组</p> <ul><li>markers：标记点用于在地图上显示标记的位置</li> <li>常用属性：</li></ul> <p><img src="/study/assets/img/image-20220305144603300.475b4124.png" alt="image-20220305144603300"></p> <p><img src="/study/assets/img/image-20220305144615665.83f77140.png" alt="image-20220305144615665"></p> <ul><li><p>polyline：指定一系列坐标点，从数组第一项连线至最后一项。绘制彩虹线时，需指定不同分段的颜色</p></li> <li><p>常用属性：</p></li></ul> <p><img src="/study/assets/img/image-20220305144637540.a093b4b5.png" alt="image-20220305144637540"></p> <ul><li>circles：在地图上显示圆</li> <li>常用属性：</li></ul> <p><img src="/study/assets/img/image-20220305144701100.53feacbe.png" alt="image-20220305144701100"></p></blockquote> <blockquote><p>由于map组件需要给定经纬度，可以通过腾讯位置服务网站提供的坐标拾取器（https://lbs.qq.com/tool/getpoint/）来获取</p></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span> <span class="token attr-name">longitude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>116.393715<span class="token punctuation">&quot;</span></span> <span class="token attr-name">latitude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>39.904987<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scale</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>18<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="标记点"><a href="#标记点" class="header-anchor">#</a> 标记点</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">markers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">iconPath</span><span class="token operator">:</span> <span class="token string">'../../assets/images/navi.png'</span><span class="token punctuation">,</span> <span class="token comment">//图标资源</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//标记点id，单击事件回调会返回此id，为每个marker设置number类型id</span>
      <span class="token literal-property property">latitude</span><span class="token operator">:</span> <span class="token number">23.099994</span><span class="token punctuation">,</span> <span class="token comment">//纬度</span>
      <span class="token literal-property property">longityde</span><span class="token operator">:</span> <span class="token number">113.324520</span><span class="token punctuation">,</span> <span class="token comment">//经度</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">50</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="定位自己位置"><a href="#定位自己位置" class="header-anchor">#</a> 定位自己位置</h3> <blockquote><ul><li><p>小程序提供了打开微信内置地图的 API 和定位用户位置的API， 需要用户授权才能使用，也就是会自动提示用户“是否同意获取您的位置”，同意后即可获取。</p></li> <li><p><strong>通过<code>wx.getLocation()</code>方法获取用户当前的位置，获取后再通过<code>wx.openLocation()</code>方法显示该位置的地图</strong></p></li> <li><p><strong>type属性用于设置返回的坐标信息，默认值为<code>wgs84</code>，表示返回GPS坐标，设为<code>gcj02</code>表示返回用于<code>wx.openLocation()</code>方法的坐标。</strong></p></li> <li><p>需要在<code>app.json</code>中声明permission字段</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATsAAADGCAYAAACtpye0AAAZaElEQVR4nO3dbXBT150G8AfGpY4ME8uoxBisQmy2IDeGLXJCgdg4JQkYJ0wcp5PuxnzwUKc0nsm+TNKdLtk1G6ZNcbrpzgAzZDI0hbTDTI0aGoKdtIMtJjYvdrKJBmw6FaVIrE2paikBy66jsfcDc27vvbqSr2TZkn2e3ydburpvkh79z7kvZ05DQ8M4iIhmubnpXgEiounAsCMiKTDsiEgKDDsikgLDjoikwLAjIikw7IhICgw7IpICw46IpMCwIyIpZKViJvfeey9WrlyJgoICLFiwAHPnMkOJKDFjY2P49NNPcf36dfT19cHv96d0/pMKu3Xr1mHz5s0oLCxM1foQkeQeeOABAMDvf/97/OY3v8Enn3ySkvkmFXY5OTnYsWMH1qxZk5KVICLSW7FiBVasWIHOzk4cOXJk0vNLOOwWLlyIxsZGFBQUTHrhREQT2bBhAxYuXIj9+/fj888/T3o+CXeuNTQ0MOiIaFqtXLkS3/72tyc1j4TC7pvf/CaWLVs2qQUSESVj9erVePTRR5N+vemwW7JkCb7xjW8kvSAiosmqrq6GxWJJ6rWmw+7BBx9MagFERKkyb948bNy4ManXmg47HnklokyQbBaZCrsvfelLsFqtSS2AiCiVioqKkrpwwdQrbDZbwjMmIpoqyWSSqbD74he/mPCMiYimSjKZxItYiUgKDDsikgLDjoikwLAjIikw7IhICgw7IpICw46IpMCwIyIpMOyISAoMOyKSAsOOiKTAsCMiKTDsiEgKDDsikgLDjoikwLAjIikw7IhICgw7IpICw46IpMCwIyIpMOyISAoMOyKSAsOOiKTAsCMiKTDsiEgKDDsikgLDjoikwLAjIikw7IhICgw7IpICw46IpMCwIyIpMOyISAoMOyKSAsOOiKTAsCMiKTDsiEgKDDsikgLDjjKG2+2Gx+NJ92rMKoFAAEePHkUgEEjL6zNJVrpXgLTcbjdu3bqFLVu2ICtr6t6ecDgMl8sFr9dr+jXFxcWoqamBxWKB2+1Ge3t7wst1Op2G2xYIBODz+VBSUpLwPNNtut6zqRIIBNDS0oIbN27EnGb//v2Gj+fn56O2thY2m22qVi9lZt47kyKBQACtra3YunXrjHijUs1iseCZZ56JejwcDuPUqVPYtGlT3P1SUVGBioqKmK8LBALo6OhAVVUVLBaL5rWRSAQnT55ET09P1HxjfamEmfTlmilsNhu+853vGD43m74nUoSdz+fDmTNnlKokE0QiEbS1tcFut6O0tFR5XB0gU2miyuzixYuGj1dWVqKioiJmZah/nfp/dWVYXV2N6upqAH+rLKqqqmC325PdpLSZrvcsnomqM6MfEdl+OKQIOzJWU1OjCVogfmXn8XgQDAY1j9XX18Nut09Y2Yn/jfT392Pp0qUoKChQHotXGZIxm82GHTt2aPZXrMpMvF+C+PE1qrYB47CM1SWRqTJ+LfW/WI899hgGBgY0FZG+ylC/CeoKZt++fUp1YYbH44HL5VL+F1WNmn7Z6l9L/etFuKi3qaenBy6XS3nO7XYD0FYLPp8Phw8fVv7Xf8hE5VpeXo5Tp04p+0oEkdltzM/PR1VVlbJdb731lrJdZvdZosLhMDweD8rLyyf9pdF/VvT7Sezb5cuXK/tTX92Ifbl161a0trZqtl//wyDo37OJ1mOiz5WYn9VqVaZTV8VTISsrS1Ntz0YZHXZGzRu3242enh7lfxE25eXlSh+U2+1GW1sbtmzZgoqKCixfvjyqGRsOh+Mu2+12w+/348UXX4TFYlF++U6ePKl8cMX6rV+/Xln25cuXlfl//vnnaGpq0mxLbm4u7HY7du7cadiM1fN4POjq6kJjY6PyhXS73Th27Jhme7xeL3Jzc7Fz505kZWXB4/HEbbqrv1zq5Yv9EqtPT08dwsDEzVi97u5u5Obmaqq6ZF27dk2pbMT71dnZqdlW8cMn3hePx4OWlhZN4Hm9XrS2tir7Trx3AOK+V8Cd/dfW1qZ8ZiORCD755BPleTOfK7GeNTU1aGpqUqbp7u6e0iaz/kd1ImZ+TDNJRofdpUuXsGrVKs0O3bBhA27duqX87/V6UVhYqJmmpKQEra2tCIVCSfVHiCODW7duVYIiKysL69at08xXrJ/6C7By5Url77Vr1yp/5+bmYunSpQiFQqY/IKLqqaqq0mxHWVkZ/H4/AoGAMq/8/HysW7dO+bIUFxfD4/FopjGSSGVn9EUXH/hYfZCCUTPW5/MpX+pQKGTY56QPz3hfMPX+zsrKgt1uh8/nQyQSUfaL0+nEhg0blOkcDgd8Ph/6+/uVfZyfn48tW7Yo773NZsP69evh8/ngcDjiVqDhcBjj4+Oaz41YL7OfK7GeDodDmaa0tBRnzpxBOBye0ma9vgo1agaLAmOmydiwi0QiuHXr1oS/pMFgEO3t7VGd7fn5+UkvOxwOw2q1Ijc3V/N4bm4urFYrwuGwqfUz6sRP5JcwHA4jOzs7KrAtFgsKCws1wTl//vykvgSlpaVR2yDmGa+y01d+/f39CIVCeOihhwynt9lsqK2tVf4Ph8M4c+aM5nn1EcFk++z0B16cTqfm+QULFmjCKisrCwsWLND0RRrty9zcXHg8HoyOjsYNO5vNBrvdjv3790c1T818rmKtpxmBQAD79u0zfC7WAQqZZGzYJSJef0q6iIqpvr4ezzzzjFL5ZAIz51XFIirIt99+2/D5WF82tfr6ely9ehXZ2dn46le/mvA6GBHbtGrVKk0T1efzpWT+iaioqMCGDRvQ1taGpqYmw77eqTCZAxQyyPiwu3r1qqYaGh0d1VQ0VqvVVPMiERaLBcFgMKoZHAqFEAwGYbFYlIpAv37AnarU5/OhpqZmUn0aFosFIyMjUU3RcDgMv9+P5cuXJzXfeOdVGR0gMbJmzRoAsU+hEevpcrlQWFiomV8gEMDo6Ciqqqpw+vTppLZBTxzRVTdRzRD7sry8PO50V69eRWFhoekqU3T465ufE32ukqWvnCdisViipg+FQujp6TF9/uNE+yzTZGzYiX6Kw4cPY/ny5cqXvbu7G16vV/liFRQUoKurC729vZqjs319fUpficViwfj4uOn+DtEUaWtrUzqpI5EIzp07B7vdrnxQS0pK0NLSAqvVqiz78uXLsNlsUU2j3t5ezYEVo+aTnsViQWlpKU6dOqXpQE9Vp368c+2MHjc61aCzs1P5gvh8vqiDN6tWrYoKTpvNhocffhiRSGRS66+mb2YGAgF0dXVh6dKlUdulfr+6u7uVdRK8Xi9Onz6tbIvoW6yvrwcQ/7zAQCCAQCCg6btVb7eZz1W6BINBU1Uo++ymgN1uR319veYIUV1dnaYfRvyitbS0aDra1b9a6n4U9aknQ0NDUb9Y4s2uqKiA2+3WNMv0zWWjZTudThQXF6OsrAwul0tpUj322GNR/UciLEUnvVFTXDymXs/KysqUnSIglisqtNLSUtjt9qg+M5/PZ3jdqvpKCp/Ph71790bNezrY7XYUFhYq75fT6URZWRkGBgY001VWViIYDCrvi9EpHcXFxSguLtZsSyJHHjs6OnDs2DHD+Zv5XKWD2QoXMH+kPtPMaWhoGJ9oojVr1mDXrl3TsT4TmuioH5nndruVKsds2MU6iVR9VLeyslIJ8njn/IllLly4EFeuXDF1ne5kzvo300RP5mob9X7MNGYv95pp1/fu3bsXfr8/oddk/lbpiP6NdevWpXtVpODz+ZQqpbKyUnOCrrqpK84JUxP9gqLZc/v2bcOgysnJmZGVAvC3swasVmu6VyVpPp8Pfr8fNTU1MyLokpXRlZ3P50MoFIq6UkLf4U1kxlRUdpl43bUMZl1lZ7FYcOrUqQkv2SKabqLZLprVDLrMl9FhF+8UCaJEmfmRtNvtpprURidjU2bjnYqJSAoMOyKSAsOOiKTAsCPS8Xg8ypFbs8St5puamtJyPS5NLKMPUMwm+hs2AtDcsNPo8qyZdtvsVNxeXZxovGDBgrQddV+0aJESePHWQX9DhcrKSjQ1NeHTTz81vNnCTHs/ZxuG3TRSnzajrxyMbgck210pppvRD5Ca1+s1/BFSv1dGdxq5++67EQgENM+JKxkofRh2lDKpOFVI3C1kuiR63qbROBw0MzDsiCZBf8NMceF/f38/srOzMW/evDSuHakx7DJEondbFs2ihx9+WHMPMqNKRd0nGGuAGafTiWPHjsHpdGLz5s347W9/i8WLF2NgYECZd319PWw2m+buy+oL/PUXnetHrFIvO9agNAAMb/QwFYPUiPmbGXtBzEt/IrFRM9ZoECFxN2L1nXd41cX0YthNI32gqUfsSqbPbmhoCG+//TZqa2tRXV2tXDus7lgXISAu0vf5fIYDzBQWFirTiPvMdXd3K/P2eDw4fPhw1Ohp8a4L7ezsxIIFC5T5qgcjijcojd5UD1Jjt9ujbmKgXnZ7eztKS0tNhVMkEsHp06eVu8cIMozelekYdtMo3gGKZKkH47FYLCgvL1fujBsOh/HnP/9ZGUQHuHOz06VLl0YNMFNSUhI17/Xr1yvTiHu8lZaWah6LNaiPuBuI+nFxQ8tAIBBzUBr9DT3TNUiNevyQRO5lJwb6cblchgc/ZtpYq7MJ93iaGYWCWTk5OVFfYvVdmcPhMC5evBg1QhegHfgnkcF69IPFxKK+07TH49FUf/EGpdGbqkFqEhmHQ9/EVd8c1qjP7vHHH4fT6Yyq7sR97xh06cG9niGMKoFUjP6UzkpCNA89Ho9mgHKLxZK2QWmEeEeO9TcyjUV/eoma3W6Hx+NBQUGBcmt3v9+PsrKylG4HmcewS7NQKITr169HNZWSPc+uv79fUwkZDfAy3UpLS1FcXAyXy6Vp8hoNSqM/ejmVg9RMJTEebW9vL4qLi3HmzBmUl5dn7PrKgJeLTaP29nY0NTWhqalJOVAhRsVKZvCcoaEhtLW1KU05MciM3W5HVlaW0tQ7d+6cpi/sww8/1DT/pkIkEsGHH35oOKhOIBBQDlZMRD1IjVjnTBqkBgCGh4fx1ltvKe+tx+NR+hW7urqwb9++CatEmnqs7KaRvqmmvrwqmWZmTk4OnE4njhw5ovQ9qU+PyMrKwpYtW9DW1hY1EM50VBgDAwN45513lP9F9SrGtzAalMYoHKd7kBoxXGc86tNVRkZGDPdpOBxW3pdUD/dJicvo27LPZiLo1q9fb/ilnWigFLMDqZA5+nMCzfR16gclEtRDDdbU1GDevHnKvBM5skuxzbrbss9mly5digo6/cmtTqfT9NFPmpxUnQfndrvR19cXdcF/dXU1HnroIU0Isv9uejHs0sToyGO8k1sp84hxg9XU4+jqzdTxVmcLHqAgIimwspuhbDYb6urq0r0aRDMGKzsikgLDjoikwLAjIikw7IhICgw7IpICw46IpMCwIyIpMOyISAoMOyKSAsOOiKTAsCMiKTDsiEgKDDsikgLDjoikwLAjIikw7IhICgw7IpICw46IpMCwIyIpMOyISAoMOyKSAsOOiKTAsCMiKTDsiEgKDDsikgLDjoikwLAjIikw7IhICgw7IpJClpmJxsbGEIlEpnpdaJYbHx/H+Pg45s7lbyxNzvj4eMKvMRV2APgBpUkbHx9HJBLhZ4nSwlTYzZ07lx9QmjRR1fGzRJM1Z86chF/DTx0RSYFhR0RSYNgRkRQYdkQkBYYdEUmBYUdEUmDYEZEUGHZEJAWGHRFJgWFHRFJg2BGRFBh2RCQFhh0RSYFhR0RSYNgRkRQYdkQkBYYdEUmBYZdC3d3d2Lx5M65cuRLz+YKCAnzve9/DyMjINK8dTdZgaAiNLx1B40tHMBgamtJlnf/4StRyxPLPf3wl6rHjrT2a1w+PjOI//9uF+hfegPePfzLcDqPnZjPTY1DI4LXXXkNzc7Phc3V1dfD7/ejo6Ih6btOmTThw4ADy8vKwdu1aPPjggzhx4gTuu+8+vPrqq/jWt76FoqKimMvcuHEjysrKUrotlF7/c/h9nP3Im9BrvnJvPv7tu9X4vxtBHPp5O8LDozjq6sTz9Y8AANrP9iEQvI2jxzuxYlk+8nJzlMfePf0xVq8qRPGye6Zic2YFhp3Kxo0b0dzcjLq6OuzZswfDw8N47rnncPPmTTQ0NODXv/41Ojo6cOLECZSVleHKlSt49tlnldcXFRVhz549AO6E2KZNm3Dw4EH09vbiwIEDUctzuVxobm7Gu+++i0OHDsUMRJpe3j/+CT848A7Cw6Mxp/nu7p9FPWa5ax6+/9xjKF52D56vf0QJKeBOpfXKwZP43R9u4Klt9+PJrc6Y8y5edg+e/cdKvPbGezj7kRfrvlaEB9YU4cmtTlwfGMTZj7xoP9uHyq+vQntXr2a5RkSV97s/3Ih6bverxw3XfzZi2E3C4OAgent7sXbtWtx1110AgOzsbPzoRz9SphkaGkJzczNeeeUVbNu2TXn8woULaGxshMPhYNBlmOJl9+Bw807l//MfX8Frb7wXNZ3NOh//9a9PIi83J+q54609+OW7Fwzn/8t3Lxg+pw7B0pWF+Mq9+cjLnY8Vy/LR+NIRBIK3Y85DhNZT2+7H0sVWHPp5O+7KngcAuCt7Hvb8S40y7WBoCP/x4+MIj4zO6nDTY9gZOHr0KI4ePar873A4NM/7/X5NszM/Px/Z2dmG89q1axeGhobw6KOPYnh4WHl84cKFqKurQ21tLYMug4nmqM06H/+0cwt+8kYbACh/f3f3z/DPOx/FA2u07+GTW52a6k3MZ6KqTtAH1P6Xdyh/TxRWx1t7sNA6HwDwl+Bt/ODAO/i75fn4uNcXtRx1ZSea0SIkZxuGnQGjZiwAfPnLXwYAXLt2DcCd0FM/7nK50NLSggMHDsBqtQK4U+nt3r0bwJ0DFEJRUZGmAqTMoq7Mvv61Yjxf/4jmYEHe3Tlo/ven8crBk3jtjfc0TcB4/XWxqjphsoEzPDIKT58PC3PnY3hk1LBpysqOJlRYWAgAuHHjBoLBIM6fPw+Hw4HVq1djZGQENpsNAPDUU0/h0KFDGBwcxPbt26Pmo68cRbjGqg5peunD6uxH3qjw0vfZhYdHsfvV43hq2/2a/jrRBE6kP0y9fBG0Zg2PfI6/BG+jdtv9aO/qBQCc+98rmgpOTf94osubSRh2CcjLy4PD4YDf70cwGITf78eiRYuQl5eH7OxslJeX47777sNzzz2H119/XemjE0drRbUndHd3G4Yhpdfz9Y+g4R82KQcUjJqpgggzo4psMDSEo8c7AfwtDGPRH9xYujhPUwHG6gNUz1P0Ie5/eQeGR0aVsFv390V45on1ie2EWYhhZyBWn11eXh4WLVqEmzdvoqurCx0dHXjhhRc0IWa1WvGLX/wCgLbZSnIRTcVA8Hbcqk7dpIxH3QeYTDM03gETYTZXdQDDzlCsPjur1YqysjI0NzfjxRdfhMPhwOOPP655rbrfTujo6EBJScm0bgOljtGR2Hj0p65MVNUBdyq76WB0gCTW0ebZhmGXIHEuHgCsXbsWS5Ys0Tx/7do1dHR0oL29XenjYzN2ZjPTjFX7pM8PS/Y8fL/xcfzkjba4FZjZyi5VJjpAMpsx7BJUXFyMTZs2oaOjA36/H8PDw8qBhZGREdy4cefETRF0JB/R5BRHbydb2cWrvPTzFX2HsbCyoygXLlzA008/rfz/0ksv4cCBA/B6vcolY6KCq6m5cz7U8PAw/H4/HA4H8vLyMDg4qEzHZuzMNdkgmEyf3WDozuVh6pAy02c3HGN+rOwIIyMjaGlpAXDnAIXf78cHH3yA3bt34+bNm3j55ZcB3LkMrK6uDjt27MDzzz+PgwcPYvXq1SgqKlKCsK6uDkuWLFHCjs3YmUd/Um+6mLm8LBGs7Ei5zEt9om8wGNRM8+abbyrBV1RUhB/+8IfYvn07Xn/9dezZs0c5yTjeFRVqH3zwQWo3glLCzJHLWIzCJJlm7PWBwbiXo6XS9YHgxBPNAgw7k86ePYvm5macOHFCubyrrKwMJ06cwPbt21FbW6tMK66oMOJyudDY2Kj873A40NDQwBOKM4j+Uq/JSqYZO9WngOiPGFvumodtD62e0mWm25yGhobxiSZas2YNdu3aNR3rQ7PY+Pg4IpEIvvCFL6R7VWiG27t3r9KSMos37yQiKTDsiEgKDDsikgLDjoikwLAjIimYCruxsbGpXg8iItOSySRTYXfr1q2EZ0xENFWSySRTYdff35/wjImIpkIoFMJnn32W8OtMhd1f//pXXL58OeGZExGlWm9vb1KvM32A4sIFOe+UQESZJdksMh12nZ2dbM4SUVpdunQJfX19Sb02oVNPjh+Pf+cGIqKp9Ktf/Srp1yYUdhcvXoTL5Up6YUREyfrpT3+a8MX/agmfVPzee++xwiOiafXmm2/i3Llzk5pHUveze//993H9+nU88cQTsNvtk1oBIqJYLl++DJfLhWvXrk16XknfvLO3txe9vb0oKyvD/fffD4fDgaws3guUiCZneHgYly5dwvnz5+HxeFI2X1M37zRr8eLFmD9/PubMmZOqWdIsMzY2hrlzeUk2RRsbG8Nnn32mjNOcaiktxQYGBlI5OyKilOFPLBFJgWFHRFJg2BGRFBh2RCQFhh0RSYFhR0RSYNgRkRQYdkQkBYYdEUmBYUdEUmDYEZEUGHZEJAWGHRFJgWFHRFL4fzAgHdWcMe3gAAAAAElFTkSuQmCC" alt="image-20220305144101509"></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>  <span class="token property">&quot;permission&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;scope.userLocation&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;你的位置信息将用于小程序位置接口的效果展示&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bindShowLocal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>查看我的位置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 查看我的位置</span>
    <span class="token function">bindShowLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">//type属性用于设置返回的坐标信息</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'gcj02'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                wx<span class="token punctuation">.</span><span class="token function">openLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">latitude</span><span class="token operator">:</span> res<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span>
                    <span class="token literal-property property">longitude</span><span class="token operator">:</span> res<span class="token punctuation">.</span>longitude<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="controls设置"><a href="#controls设置" class="header-anchor">#</a> controls设置</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">controls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//在控件单击事件回调返回此id</span>
      <span class="token literal-property property">iconPath</span><span class="token operator">:</span> <span class="token string">'../../assets/images/banner.png'</span><span class="token punctuation">,</span> <span class="token comment">//图标路径</span>
      <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//定位</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">375</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">71</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">clickable</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">//为true可以单击</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="获取控件id"><a href="#获取控件id" class="header-anchor">#</a> 获取控件id</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> id <span class="token operator">=</span> e<span class="token punctuation">.</span>controlId
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="回到当前位置"><a href="#回到当前位置" class="header-anchor">#</a> 回到当前位置</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>mapCtx <span class="token operator">=</span> <span class="token function">createMapContext</span><span class="token punctuation">(</span><span class="token string">'myMap'</span><span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>mapCtx<span class="token punctuation">.</span><span class="token function">moveToLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="获取中心点坐标"><a href="#获取中心点坐标" class="header-anchor">#</a> 获取中心点坐标</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>mapCtx <span class="token operator">=</span> <span class="token function">createMapContext</span><span class="token punctuation">(</span><span class="token string">'myMap'</span><span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>mapCtx<span class="token punctuation">.</span>getCenterLocation
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="picker"><a href="#picker" class="header-anchor">#</a> picker</h2> <blockquote><ul><li>picker组件是从底部弹起的滚动选择器，目前支持5种选择器，<strong>通过mode属性来区分，分别是普通选择器（mode=&quot;selector&quot;）、多列选择器（mode=&quot;multiSelector&quot;）、时间选择器（mode=&quot;time&quot;）、日期选择器（mode=&quot;date&quot;）和省市区选择器（mode=&quot;region&quot;），默认是普通选择器。</strong></li></ul></blockquote> <p><img src="/study/assets/img/image-20220305165030222.0ebe13a1.png" alt="image-20220305165030222"></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>picker</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{index}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">range</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{range}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeRange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>当前选择是:{{range[index]}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>picker</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">range</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token string">'css'</span><span class="token punctuation">,</span> <span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'微信小程序'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">changeRange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> d <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">index</span><span class="token operator">:</span> d
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><ul><li>range属性表示显示在底部选择器的列表数组，数组中的每一个元素对应列表中的每一项。</li> <li>value属性表示当前选择了range数组中的某个元素的下标，默认值为0（下标从0开始）。</li> <li>bindchange用于绑定change事件，该事件会在value改变时触发。</li></ul></blockquote> <h2 id="弹框提示"><a href="#弹框提示" class="header-anchor">#</a> 弹框提示</h2> <blockquote><p><strong>通过<code>wx.showToast()</code>方法显示提示信息</strong>，在该方法的参数中，</p> <ul><li><strong>title表示提示文本，</strong></li> <li><strong>icon表示提示图标，图标的默认值为success（成功），还可以设为loading（加载中）或none（无图标）</strong></li> <li><strong>duration表示显示多少毫秒后自动消失。</strong></li></ul></blockquote> <h2 id="发送婚礼请帖回复通知"><a href="#发送婚礼请帖回复通知" class="header-anchor">#</a> 发送婚礼请帖回复通知</h2> <h3 id="获取订阅消息模板"><a href="#获取订阅消息模板" class="header-anchor">#</a> 获取订阅消息模板</h3> <blockquote><ul><li><p>在移动应用开发中，经常需要为用户发送一些消息，如支付成功提醒、到账提醒，或者向用户推送一些广告等。模板消息是在小程序中向用户发送消息的一种方式，其特点是必须按照小程序提供的模板来给用户发送消息，而且小程序在审核时，会对消息的标题、关键字等进行审查，以免功能被恶意使用</p></li> <li><p>首先需要在“小程序管理后台”中单击左侧菜单中的“模板消息”，然后单击“添加”按钮添加模板</p> <p><img src="/study/assets/img/image-20220305170711471.6a6a0938.png" alt="image-20220305170711471"></p></li> <li><p>在实际开发中，模板消息的发送一般是在服务器端进行的，也就是由服务器主动发送给曾经使用过这个小程序的用户，小程序本身并不具备接收消息的功能，而是由微信中的服务通知功能将消息转达给用户。并且为了证明某个用户使用过某个小程序，需要满足如下两个条件中的一个。</p> <ol><li>​	支付：用户在小程序内完成过支付行为，可允许开发者向用户在7天内推送有限条数的模板消息，1次支付可以发3条消息。</li> <li>提交表单：当用户在小程序内发生过提交表单行为，且该表单声明为要发模板消息，开发者需要向用户提供服务时，可允许开发者向用户在7天内推送有限条数的模板消息，1次提交表单可下发1条。</li></ol></li></ul></blockquote> <h3 id="获取订阅消息权限"><a href="#获取订阅消息权限" class="header-anchor">#</a> 获取订阅消息权限</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token operator">...</span>
	<span class="token literal-property property">globalData</span><span class="token operator">:</span><span class="token punctuation">{</span>
	  <span class="token literal-property property">hasSubscribeMessage</span><span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//guest.js</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token operator">...</span>
   <span class="token comment">// 订阅消息权限</span>
    <span class="token function-variable function">allowSubscribe</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>hasSubscribeMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wx<span class="token punctuation">.</span><span class="token function">requestSubscribeMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">tmplIds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'F2X7n5b8HEhfM8BE4AmJ5N_btBO8U7--KVm90dvdK-A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 在此处填写模板id</span>
                <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                    app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>hasSubscribeMessage <span class="token operator">=</span> res<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="发送订阅消息"><a href="#发送订阅消息" class="header-anchor">#</a> 发送订阅消息???</h3> <p><img src="/study/assets/img/image-20220306144113365.825511c9.png" alt="image-20220306144113365"></p> <h1 id="api应用"><a href="#api应用" class="header-anchor">#</a> API应用</h1> <h2 id="用户登录"><a href="#用户登录" class="header-anchor">#</a> 用户登录</h2> <blockquote><p>用户登录流程需要小程序、开发者服务器和微信接口服务3个角色的参与</p> <ol><li><strong>在小程序中通过<code>wx.login()</code>获取登录凭证 code</strong> <ul><li>code 由小程序内部自动生成，<strong>每次调用<code>wx.login()</code>获得的code都不同</strong>。需要注意的是，code有效期为5分钟，且被微信接口服务验证一次后就会失效。</li></ul></li> <li>在获取code后，<strong>小程序使用<code>wx.request()</code>将code发送给开发者服务器。</strong></li> <li><strong>开发者服务器将 AppId、AppSecret、code 发送给微信接口服务校验登录凭证，如果校验成功，返回session_key和openid等。</strong> <ul><li>其中，AppId是小程序的唯一标识，AppSecret是小程序的密钥，对于微信接口服务而言，它们相当于小程序账号的id和密码。</li> <li>微信接口服务校验成功后会返回 session_key 和 openid,openid 是用户的唯一标识， session_key是对用户数据进行加密签名的密钥，具体会在后面讲解。需要注意的是，openid并不等同于微信用户id，同一个微信用户在不同AppId小程序中的openid是不同的。</li></ul></li> <li><strong>在用户登录成功后，开发者服务器将openid和session_key保存，然后生成一个自定义登录态的token（令牌）响应给小程序，通过token可以查询到openid和session_key。</strong> <ul><li>小程序下次请求时只要携带token，就可以证明用户已经登录。</li></ul></li></ol></blockquote> <p><img src="/study/assets/img/image-20220310173603617.fac9d5b6.png" alt="image-20220310173603617"></p> <h2 id="数据缓存"><a href="#数据缓存" class="header-anchor">#</a> 数据缓存</h2> <blockquote><ul><li>在小程序中可以缓存一些数据，从而在小程序退出后再次打开时，可以从缓存中读取上次保存的数据。</li> <li><strong>异步方式通过传入回调函数获取结果，而同步方式通过返回值获取结果。如果发生错误，异步方式会执行fail回调函数返回错误，而同步方式则通过<code>try…catch</code>捕获异常来获取错误信息。</strong></li> <li>在保存数据缓存时需要指定一个 key，在保存后，通过 key 来读取保存的内容。</li></ul></blockquote> <p><img src="/study/assets/img/image-20220310173716574.78e1c612.png" alt="image-20220310173716574"></p> <p><img src="/study/assets/img/image-20220310173731446.9a455563.png" alt="image-20220310173731446"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token function">saveInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'key'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 获取数据缓存</span>
    <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">getStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'key'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="实现用户登录"><a href="#实现用户登录" class="header-anchor">#</a> 实现用户登录</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> wx <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">appid</span><span class="token operator">:</span> <span class="token string">'wxa673cf76ca230c2a'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'e363d743d49592d98b1227d72b1bcd87'</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">session</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 注意：小程序端的appid必须使用真实账号，如果使用测试账号，会出现login code错误</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'login code: '</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
    <span class="token comment">// 校验登录凭证的微信接口</span>
    <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'https://api.weixin.qq.com/sns/jscode2session?appid='</span> <span class="token operator">+</span> wx<span class="token punctuation">.</span>appid <span class="token operator">+</span> <span class="token string">'&amp;secret='</span> <span class="token operator">+</span> wx<span class="token punctuation">.</span>secret <span class="token operator">+</span> <span class="token string">'&amp;js_code='</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>code <span class="token operator">+</span> <span class="token string">'&amp;grant_type=authorization_code'</span>
    
    <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> response<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'session: '</span> <span class="token operator">+</span> body<span class="token punctuation">)</span>
        <span class="token comment">// body中有session_key和openid</span>
        <span class="token keyword">var</span> session <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token punctuation">.</span>openid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取token</span>
            <span class="token keyword">var</span> token <span class="token operator">=</span> <span class="token string">'token_'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// 根据token存放session_key和openid</span>
            db<span class="token punctuation">.</span>session<span class="token punctuation">[</span>token<span class="token punctuation">]</span> <span class="token operator">=</span> session
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span>user<span class="token punctuation">[</span>session<span class="token punctuation">.</span>openid<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                db<span class="token punctuation">.</span>user<span class="token punctuation">[</span>session<span class="token punctuation">.</span>openid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">credit</span><span class="token operator">:</span> <span class="token number">100</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 响应token</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">token</span><span class="token operator">:</span> token
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server running at http://127.0.0.1:3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;app.js:&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
        wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3000/login'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span> res<span class="token punctuation">.</span>code
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span>
              token
            <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>data
			<span class="token comment">// 将token数据保存缓存当中</span>
            wx<span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> token
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token comment">// 将token保存到app.js文件中</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token <span class="token operator">=</span> token
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
  <span class="token comment">// 保存token</span>
  <span class="token literal-property property">globalData</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 调用login()方法</span>
  <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="获取登录积分"><a href="#获取登录积分" class="header-anchor">#</a> 获取登录积分</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 获取积分</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/credit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>session<span class="token punctuation">)</span>
    <span class="token comment">//req.query.token = xxx</span>
    <span class="token comment">//db.session[req.query.token] = db.session.xxx</span>
    <span class="token keyword">var</span> session <span class="token operator">=</span> db<span class="token punctuation">.</span>session<span class="token punctuation">[</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>token<span class="token punctuation">]</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;get:&quot;</span> <span class="token operator">+</span> session<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">&amp;&amp;</span> db<span class="token punctuation">.</span>user<span class="token punctuation">[</span>session<span class="token punctuation">.</span>openid<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">credit</span><span class="token operator">:</span> db<span class="token punctuation">.</span>user<span class="token punctuation">[</span>session<span class="token punctuation">.</span>openid<span class="token punctuation">]</span><span class="token punctuation">.</span>credit
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">err</span><span class="token operator">:</span> <span class="token string">'用户不存在，或未登录。'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// 获取积分</span>
    <span class="token function">getCredit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3000/credit'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">token</span><span class="token operator">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="检查是否登录"><a href="#检查是否登录" class="header-anchor">#</a> 检查是否登录</h3> <blockquote><p>小程序登录成功后，已经将服务器返回的token保存在数据缓存中了。下次启动小程序时，应该<strong>判断数据缓存中是否存在token，如果存在，直接取出这个token即可，不用再执行登录操作</strong>。需要注意的是，token有可能会过期，需要重新登录，这就需要在从数据缓存中取出token后，先验证token是否过期，再使用token。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 检查是否登录</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/checklogin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//req.query.token = xxx</span>
    <span class="token comment">//db.session[req.query.token] = db.session.xxx</span>
    <span class="token keyword">var</span> session <span class="token operator">=</span> db<span class="token punctuation">.</span>session<span class="token punctuation">[</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>token<span class="token punctuation">]</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'checklogin: '</span><span class="token punctuation">,</span> session<span class="token punctuation">)</span>
    <span class="token comment">// 将用户是否已经登录的布尔值返回给客户端</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">is_login</span><span class="token operator">:</span> session <span class="token operator">!==</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token operator">...</span>
  <span class="token comment">// 保存的token</span>
  <span class="token literal-property property">globalData</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 检查是否登录</span>
  <span class="token function">checkLogin</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> token <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token <span class="token operator">=</span> token
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">isLogin</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">isLogin</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3000/checklogin'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">token</span><span class="token operator">:</span> token
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">isLogin</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>is_login
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkLogin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="获取用户信息"><a href="#获取用户信息" class="header-anchor">#</a> 获取用户信息</h3> <blockquote><p>在小程序中，获取用户信息有两种常用的方式，</p> <ol><li><p>一种是使用<code>&lt;open-data&gt;</code>组件，它不需要用户授权，就可以显示用户的头像、昵称、性别等方式，适合只用来展示的情况。</p> <p>性别的属性lang 用于设置语言，有效值有en（英语）、zh_CN（简体中文）、zh_TW（繁体中文）</p></li> <li><p>另一种方式是通过单击按钮，提示用户授权，获取到用户信息数据。</p></li></ol></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- open-data组件 --&gt;</span>

<span class="token comment">&lt;!-- 用户头像 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>open-data</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userAvatarUrl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>open-data</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 用户昵称 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>open-data</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userNickName<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>open-data</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 用户性别 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>open-data</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userGender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zh_CN<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>open-data</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>使用API获取用户授权</p></blockquote> <blockquote><p>数据缓存的有效期有限，如果用户在上一次授权后修改了用户信息，会导致数据缓存中的用户信息于最新的不一致。建议使用<code>&lt;open-data&gt;</code>组件展示用户的昵称和头像</p></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getUserInfo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>获取用户信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{userInfo.avatarUrl}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>用户名：{{userInfo.nickName}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>国家：{{userInfo.country}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>省份：{{userInfo.province}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>城市：{{userInfo.city}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- &lt;open-data type=&quot;userGender&quot; lang=&quot;zh_CN&quot;&gt;&lt;/open-data&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>性别：{{userInfo.gender==0?&quot;未知&quot;:(userInfo==1?&quot;男&quot;:&quot;女&quot;)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><ul><li><strong>调用wx.getUserProfile()方法，用于获取用户信息，该方法调用后会弹出授权提示，只有用户允许的情况下才能获取用户信息</strong></li> <li>wx.getUserProfile()方法在基础库2.10.4版本以上才开始支持。低于这个版本可以使用wx.getUserInfo()方法代替，但此方法目前已淘汰，它返回的是一个虚拟的用户信息</li> <li>wx.getUserProfile()方法的返回值
<ul><li>avatarUrl：用户头像的URL地址。</li> <li>nickName：用户昵称。</li> <li>gender：用户的性别，0表示未知，1表示男，2表示女。</li> <li>country：用户所在的国家。</li> <li>province：用户所在省份。</li> <li>city：用户所在的城市。</li></ul></li> <li>目前信息安全问题现在只能获取到头像和用户昵称，其他的无法获取。</li></ul></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// 获取用户信息</span>
    <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'展示用户信息'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">userInfo</span><span class="token operator">:</span> res<span class="token punctuation">.</span>userInfo
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 保存到缓存</span>
                wx<span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&quot;userInfo&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span> res<span class="token punctuation">.</span>userInfo
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>将缓存的用户信息保存到app.js中，避免每一次重新打开需要重新授权的问题。感觉可以光保存在缓存中，直接从缓存中去就可以</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token operator">...</span>
   <span class="token literal-property property">globalData</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">userInfo</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>userInfo <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'userInfo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="开放数据校验和解密"><a href="#开放数据校验和解密" class="header-anchor">#</a> 开放数据校验和解密</h3> <blockquote><ul><li>如果开发者服务器想要获取用户信息，则需要在小程序端通过<code>wx.request()</code>将获取到的用户信息发送给开发者服务器。但是这种方式存在一个问题，就是开发者服务器无法辨别数据的真伪。为此，小程序提供了开放数据的校验和解密机制。</li> <li><code>wx.getUserProfile()</code>回调函数参数res包含
<ul><li>errMsg：错误信息。</li> <li>userInfo：用户信息对象，不包含openid等敏感信息。</li> <li>rawData：不包括敏感信息的原始数据字符串，用于计算签名。</li> <li>signature：使用sha1(rawData + session_key)得到字符串，用于校验用户信息。</li> <li>encryptedData：包括敏感数据在内的完整用户信息的加密数据。</li> <li>iv：加密算法的初始向量。</li></ul></li> <li>解密后，除了可以获取用户的nickName、gender、city、province、country和avatarUrl，还可以获取到以下信息。
<ul><li>openId:用户在当前AppId的小程序下的唯一id</li> <li>unionId: 同一个微信开放平台账号下的用户唯一id</li> <li>watermark:数据水印，用于校验数据的有效性
<ul><li>appid: 敏感数据归属AppId，开发者可校验此参数与自身AppId是否一致</li> <li>timestamp:敏感数据获取的时间戳，开发者可以用于数据时效性校验</li></ul></li></ul></li></ul></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// 向服务器发送数据</span>
    <span class="token function-variable function">sendUserInfo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> token <span class="token operator">=</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token
        wx<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'获取头像昵称'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3000/userinfo?token='</span> <span class="token operator">+</span> token<span class="token punctuation">,</span>
                    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">rawData</span><span class="token operator">:</span> res<span class="token punctuation">.</span>rawData<span class="token punctuation">,</span>
                        <span class="token literal-property property">signature</span><span class="token operator">:</span> res<span class="token punctuation">.</span>signature<span class="token punctuation">,</span>
                        <span class="token literal-property property">encryptedData</span><span class="token operator">:</span> res<span class="token punctuation">.</span>encryptedData<span class="token punctuation">,</span>
                        <span class="token literal-property property">iv</span><span class="token operator">:</span> res<span class="token punctuation">.</span>iv
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p>然后编写服务器端代码，在小程序官方文档中提供了解密的示例代码，有 C++、PHP、Node.js、Python版本，可以自行下载。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">WXBizDataCrypt</span><span class="token punctuation">(</span><span class="token parameter">appId<span class="token punctuation">,</span> sessionKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>appId <span class="token operator">=</span> appId
  <span class="token keyword">this</span><span class="token punctuation">.</span>sessionKey <span class="token operator">=</span> sessionKey
<span class="token punctuation">}</span>

<span class="token class-name">WXBizDataCrypt</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">decryptData</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">encryptedData<span class="token punctuation">,</span> iv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// base64 decode</span>
  <span class="token keyword">var</span> sessionKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sessionKey<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span>
  encryptedData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>encryptedData<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span>
  iv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>iv<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
     <span class="token comment">// 解密</span>
    <span class="token keyword">var</span> decipher <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createDecipheriv</span><span class="token punctuation">(</span><span class="token string">'aes-128-cbc'</span><span class="token punctuation">,</span> sessionKey<span class="token punctuation">,</span> iv<span class="token punctuation">)</span>
    <span class="token comment">// 设置自动 padding 为 true，删除填充补位</span>
    decipher<span class="token punctuation">.</span><span class="token function">setAutoPadding</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> decoded <span class="token operator">=</span> decipher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>encryptedData<span class="token punctuation">,</span> <span class="token string">'binary'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
    decoded <span class="token operator">+=</span> decipher<span class="token punctuation">.</span><span class="token function">final</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
    
    decoded <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>decoded<span class="token punctuation">)</span>

  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Illegal Buffer'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>decoded<span class="token punctuation">.</span>watermark<span class="token punctuation">.</span>appid <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Illegal Buffer'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> decoded
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> WXBizDataCrypt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><blockquote><p>引入加密解密的模块</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 加密解密</span>
<span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> WXBizDataCrypt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./WXBizDataCrypt'</span><span class="token punctuation">)</span>

<span class="token operator">...</span><span class="token operator">...</span>

<span class="token comment">// 加密 解密</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/userinfo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取session值</span>
    <span class="token keyword">var</span> session <span class="token operator">=</span> db<span class="token punctuation">.</span>session<span class="token punctuation">[</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>token<span class="token punctuation">]</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'session:'</span> <span class="token operator">+</span> session<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 使用appid和session_key解密encryptedData</span>
        <span class="token keyword">var</span> pc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WXBizDataCrypt</span><span class="token punctuation">(</span>wx<span class="token punctuation">.</span>appid<span class="token punctuation">,</span> session<span class="token punctuation">.</span>session_key<span class="token punctuation">)</span>
        <span class="token keyword">var</span> data <span class="token operator">=</span> pc<span class="token punctuation">.</span><span class="token function">decryptData</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>encryptedData<span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>iv<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'解密后：'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token comment">// 校验rawData是否正确通过</span>
        <span class="token keyword">var</span> sha1 <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'sha1'</span><span class="token punctuation">)</span>
        sha1<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>rawData <span class="token operator">+</span> session<span class="token punctuation">.</span>session_key<span class="token punctuation">)</span>
        <span class="token keyword">var</span> signature2 <span class="token operator">=</span> sha1<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>signature2<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>signature<span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">pass</span><span class="token operator">:</span> signature2 <span class="token operator">===</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>signature
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">err</span><span class="token operator">:</span> <span class="token string">'用户不存在，或未登录。'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server running at http://127.0.0.1:3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><blockquote><p>注意：</p> <p>session_key是用户的会话密钥，需要存储在服务器中，调用获取用户信息等微信接口时，需要用这个会话密钥，才能解密获取相关数据。为了应用自身的数据安全，开发者服务器不应该把session_key下发到小程序，也不应该对外提供这个密钥。小程序每次调用wx.login()时，会自动生成新的session_key，导致原来的session_key失效。如果需要检查session_key是否失效，可以通过<code>wx.checkSession()</code>进行检查。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 
　　wx<span class="token punctuation">.</span><span class="token function">checkSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
 
　　　　<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 
　　　　　　console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;处于登录态&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
　　　　<span class="token punctuation">}</span><span class="token punctuation">,</span>
 
　　　　<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 
　　　　　　console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;需要重新登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
　　　　　　wx<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>　　
 
　　　　<span class="token punctuation">}</span>
 
　　<span class="token punctuation">}</span><span class="token punctuation">)</span>
 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></blockquote> <h2 id="wx-switchtab"><a href="#wx-switchtab" class="header-anchor">#</a> wx.switchTab</h2> <blockquote><ul><li><strong><code>wx.switchTab</code>用于跳转页面，且只能跳转到tabBar页面，并关闭其他所有非tabBar页面。</strong></li> <li>注意：<code>url: '../person/person'</code>要写成这样，最后不要加.wxml。其他页面跳转API一样</li> <li>路径后面不可以携带参数</li></ul></blockquote> <p><img src="/study/assets/img/image-20220324163719320.b2521c2a.png" alt="image-20220324163719320"></p> <h2 id="wx-navigateto和wx-redirectto"><a href="#wx-navigateto和wx-redirectto" class="header-anchor">#</a> wx.navigateTo和wx.redirectTo</h2> <blockquote><ul><li><strong><code>wx.navigateTo</code>用于跳转到应用内的某个页面，且保留当前页面。跳转页面后，单击左上角可以返回到上一个页面。<strong>需要注意的是，</strong><code>wx.navigateTo</code>只能跳转到非标签页。使用<code>wx.navigateBack</code>可以返回到原页面。</strong></li> <li>**在<code>wx.navigateTo</code>中，可以<code>let pages = getCurrentPages()</code>方法获取页面栈，获取的是一个数组。**获取当前页就是<code>pages[pages.length-1]</code>，上一页就是<code>pages[pages.length-2]</code>，可以使用<code>this.setData()</code>来操作上一页的data数据</li> <li><strong><code>wx.redirectTo</code>用于跳转到应用内的某个页面，且关闭当前页面，不能返回到上一个页面，只能跳转到非标签页。</strong></li></ul></blockquote> <p><img src="/study/assets/img/image-20220324164102149.d13bc4a2.png" alt="image-20220324164102149"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">url</span><span class="token operator">:</span> detail<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">1</span>'
<span class="token punctuation">}</span><span class="token punctuation">)</span>

wx<span class="token punctuation">.</span><span class="token function">redirectTo</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">url</span><span class="token operator">:</span> detail<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">1</span>'
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>在onLoad()函数中接收传过来的参数id。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token comment">// 接收参数值id=1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="wx-relaunch"><a href="#wx-relaunch" class="header-anchor">#</a> wx.reLaunch</h2> <blockquote><ul><li><strong><code>wx.reLaunch</code>关闭所有页面，打开到应用内的某个页面。既能跳转到标签页，又能跳转到非标签页。</strong></li> <li>路径后面可以携带参数</li></ul></blockquote> <h2 id="wx-chooseimage"><a href="#wx-chooseimage" class="header-anchor">#</a> wx.chooseImage</h2> <blockquote><p><strong><code>wx.chooseImage()</code>方法从本地相册选择图片或使用相机拍照</strong></p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>        wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">//设置选择图片的最大数量</span>
            <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'camera'</span><span class="token punctuation">,</span> <span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//设置图片的来源，相机或者图库</span>
            <span class="token literal-property property">sizeType</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'original'</span><span class="token punctuation">,</span> <span class="token string">'compressed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//设置图片是原图还是缩略图</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">imageSrc</span><span class="token operator">:</span> res<span class="token punctuation">.</span>tempFilePaths
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="wx-makephonecall"><a href="#wx-makephonecall" class="header-anchor">#</a> wx.makePhoneCall</h2> <blockquote><p><strong>通过调用<code>wx.makePhoneCall()</code>接口实现呼叫功能</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token function">callGroom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     wx<span class="token punctuation">.</span><span class="token function">makePhoneCall</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
         <span class="token literal-property property">phoneNumber</span><span class="token operator">:</span> <span class="token string">'18063345001'</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></blockquote> <h2 id="腾讯地图附近地点查找api"><a href="#腾讯地图附近地点查找api" class="header-anchor">#</a> 腾讯地图附近地点查找API</h2> <h3 id="sdk导入"><a href="#sdk导入" class="header-anchor">#</a> sdk导入</h3> <p>![](./README.assets/TXmap (1).png)</p> <p><img src="/study/assets/img/image-20220326160712085.b7d54932.png" alt="image-20220326160712085"></p> <p><img src="/study/assets/img/image-20220326160745193.3c5e59b5.png" alt="image-20220326160745193"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> QQMapWX <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../utils/qqmap-wx-jssdk'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> qqmapsdk

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    qqmapsdk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QQMapWX</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'VNVBZ-5ZR6X-J6W4Y-7QZQT-FH632-WHFEU'</span><span class="token comment">//申请的key</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    qqmapsdk<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">keyword</span><span class="token operator">:</span> <span class="token string">'酒店'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="获取手机系统信息"><a href="#获取手机系统信息" class="header-anchor">#</a> 获取手机系统信息</h3> <blockquote><p><strong><code>wx.getSystemInfo()</code>获取手机系统信息</strong></p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    wx<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">//获取手机系统信息</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>model<span class="token punctuation">)</span> <span class="token comment">//手机型号</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">)</span> <span class="token comment">//设置像素比</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>windowWidth<span class="token punctuation">)</span> <span class="token comment">//可使用窗口宽度</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>windowHeight<span class="token punctuation">)</span> <span class="token comment">//可使用窗口高度</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>language<span class="token punctuation">)</span> <span class="token comment">//微信设置的语言</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>version<span class="token punctuation">)</span> <span class="token comment">//微信版本号</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>platform<span class="token punctuation">)</span> <span class="token comment">//客户端平台</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="canvas"><a href="#canvas" class="header-anchor">#</a> canvas???</h2> <blockquote><ul><li>anvas（画布）组件是小程序中的原生组件。默认宽高为300px×225px。在同一个页面中，它的canvas-id是唯一的，如果使用了重复的canvas-id，该<code>&lt;canvas&gt;</code>标签对应的画布将被隐藏，不再正常工作。</li> <li>使用canvas绘图是在js文件中通过对canvas的控制来绘制图形的。</li></ul></blockquote> <p><img src="/study/assets/img/image-20220329175121271.212d8517.png" alt="image-20220329175121271"></p> <h3 id="canvas-2d-示例代码"><a href="#canvas-2d-示例代码" class="header-anchor">#</a> Canvas 2D 示例代码</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  <span class="token comment">&lt;!-- canvas.wxml --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2d<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myCanvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// canvas.js</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#myCanvas'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> canvas <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>node
        <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>

        <span class="token keyword">const</span> dpr <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pixelRatio
        canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>width <span class="token operator">*</span> dpr
        canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>height <span class="token operator">*</span> dpr
        ctx<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>dpr<span class="token punctuation">,</span> dpr<span class="token punctuation">)</span>

        ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="webgl-示例代码"><a href="#webgl-示例代码" class="header-anchor">#</a> WebGL 示例代码</h3> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  <span class="token comment">&lt;!-- canvas.wxml --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myCanvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// canvas.js</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#myCanvas'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> canvas <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>node
      <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="动画"><a href="#动画" class="header-anchor">#</a> 动画???</h2> <h3 id="wx-createanimation"><a href="#wx-createanimation" class="header-anchor">#</a> wx.createAnimation</h3> <blockquote><p><code>wx.createAnimation</code>用于创建一个animation实例，然后调用实例的方法来描述动画，最后通过动画实例export方法导出动画数据传递给组件中的animation属性。</p> <p><img src="/study/assets/img/image-20220329180615025.bd38a542.png" alt="image-20220329180615025"></p> <p>timingFunction有多个可选值，具体如下。</p> <ul><li>linear：动画从头到尾的速度是相同的。</li> <li>ease：动画以低速开始，然后加快，在结束前变慢。</li> <li>ease-in：动画以低速开始。</li> <li>ease-in-out：动画以低速开始和结束。</li> <li>ease-out：动画以低速结束。</li> <li>step-start：动画第一帧就跳至结束状态直到结束。</li> <li>step-end：动画一直保持开始状态，最后一帧跳到结束状态。</li></ul></blockquote> <h3 id="animation"><a href="#animation" class="header-anchor">#</a> animation</h3> <blockquote><p>animation 动画对象可以调用一些方法来描述动画，调用结束会返回自身（animation），支持链式的写法。下面列举一些常用的方法。</p> <ol><li>animation.step(Object object)：动画队列，表示一组动画完成，可以在一组动作中使用多个动画方法，一组动画完成之后才会进行下一组动画。</li> <li>animation.export()：导出动画队列，export()方法每次调用后会清掉之前的动画操作。</li> <li>animation.rorate(number angle)：从原点顺时针旋转一个角度，角度范围为-180～180。</li> <li>animation.scale(number sx, number sy)：缩放，当只有sx参数时，表示X、Y轴同时缩放sx倍数。如果sx和sy参数都存在，sx表示X轴缩放的倍数，sy表示Y轴缩放的倍数。</li> <li>animation.skew(number ax, number ay)：对X、Y轴坐标进行倾斜，倾斜范围是-180～180。</li> <li>animation.translate(number tx, number ty)：平移变换，当只有tx参数时，表示X轴偏移tx，单位是px。ty表示Y轴平移的距离，单位是px。</li></ol></blockquote> <h2 id="录音api"><a href="#录音api" class="header-anchor">#</a> 录音API</h2> <blockquote><ul><li>微信小程序提供了用于录制音频的API，<strong><code>wx.getRecorderManager()</code> 获取全局唯一的录音管理器</strong></li> <li><strong>在录音完成后，在onStop事件中可以用<code>res.tempFilePath</code>获取音频文件的临时保存路径。</strong></li></ul></blockquote> <p><img src="/study/assets/img/image-20220327111807816.389f4843.png" alt="image-20220327111807816"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> recorderManager <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getRecorderManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 录音开始事件</span>
recorderManager<span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开始录音&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 录音继续事件</span>
recorderManager<span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;继续录音&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 录音暂停事件</span>
recorderManager<span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;暂停录音&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 录音停止事件</span>
recorderManager<span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;停止录音&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听已录制完指定帧大小的文件事件</span>
recorderManager<span class="token punctuation">.</span><span class="token function">onFrameRecorded</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
        framBUffer
    <span class="token punctuation">}</span> <span class="token operator">=</span> res
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'framBuffer.byteLength'</span><span class="token punctuation">,</span> framBUffer<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 录音选项</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">60000</span><span class="token punctuation">,</span> <span class="token comment">//录音时长，最大值10分钟</span>
    <span class="token literal-property property">sampleRate</span><span class="token operator">:</span> <span class="token number">44100</span><span class="token punctuation">,</span> <span class="token comment">//采样率</span>
    <span class="token literal-property property">numberOfChannels</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//录音通道数，默认为2</span>
    <span class="token literal-property property">encodeBitRate</span><span class="token operator">:</span> <span class="token number">192000</span><span class="token punctuation">,</span> <span class="token comment">//编码码率</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'map3'</span><span class="token punctuation">,</span> <span class="token comment">//音频格式</span>
    <span class="token literal-property property">framSize</span><span class="token operator">:</span> <span class="token number">50</span> <span class="token comment">//指定帧大小，单位KB</span>
<span class="token punctuation">}</span>

<span class="token comment">// 开始录音</span>
recorderManager<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>

<span class="token comment">// 暂停录音</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    recorderManager<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h2 id="文件上传与下载"><a href="#文件上传与下载" class="header-anchor">#</a> 文件上传与下载</h2> <h3 id="上传"><a href="#上传" class="header-anchor">#</a> 上传</h3> <blockquote><p><strong><code>wx.uploadFile</code>用于将本地资源上传到开发者服务器，将会发起 HTTPS POST 请求，其中<code>content-Type</code>字段为<code>multipart/form-data</code>。</strong></p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code> 	<span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> imageTempPath <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePaths

                wx<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">filePath</span><span class="token operator">:</span> imageTempPath<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//上传的文件路径</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token comment">//文件对应key</span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'url'</span><span class="token punctuation">,</span> <span class="token comment">//请求路径</span>
                    <span class="token comment">// https请求中其他额外的form data</span>
                    <span class="token literal-property property">formData</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token string-property property">'user'</span><span class="token operator">:</span> <span class="token string">'test'</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="下载"><a href="#下载" class="header-anchor">#</a> 下载</h3> <blockquote><p>**<code>wx.downloadFile</code>用于下载文件资源到本地，将会发起HTTPS GET请求，返回文件的本地临时路径。**在服务器响应的header中指定合理的<code>content-Type</code>字段，确保客户端能正确处理文件类型</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'url'</span><span class="token punctuation">,</span> <span class="token comment">//服务器</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// 判断服务器状态码</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="录音上传"><a href="#录音上传" class="header-anchor">#</a> 录音上传</h2> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>record<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>录音<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stop<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>停止<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>playback<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>回放<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> recorderManger <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getRecorderManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> Ctx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createInnerAudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> tempFilePath <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
recorderManger<span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    tempFilePath <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePath
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        recorderManger<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        recorderManger<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">playback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Ctx<span class="token punctuation">.</span>src <span class="token operator">=</span> tempFilePath
        Ctx<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tempFilePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wx<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">filePath</span><span class="token operator">:</span> tempFilePath<span class="token punctuation">,</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'录音'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3000/upload'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'你还没有录音呢'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h2 id="音频下载"><a href="#音频下载" class="header-anchor">#</a> 音频下载</h2> <blockquote><p>showLoading和hideLoading成对出现，类似showToast</p></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>play<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>播放文章<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paused<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>暂停<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'下载音频文件中'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">mask</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        wx<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3000/1.mp3'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                Ctx<span class="token punctuation">.</span>src <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePath
                Ctx<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">paused</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Ctx<span class="token punctuation">.</span>paused<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Ctx<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            Ctx<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="在线聊天"><a href="#在线聊天" class="header-anchor">#</a> 在线聊天</h2> <h3 id="websocket"><a href="#websocket" class="header-anchor">#</a> WebSocket</h3> <blockquote><ul><li>小程序的WebSocket接口实现了浏览器和服务器的全双工通信。WebSocket 是客户端与服务器之间专门建立的一条通道，在小程序中<strong>通过<code>wx.connectSocket</code>建立连接</strong>，就可以从通道中实时获取服务器的数据。</li> <li>需要注意的是， <strong>WebSocket的协议是以ws或wss开头的（类似于http和https的关系），在小程序中，正式项目必须使用wss协议，在开发模式下可以使用ws协议。</strong></li> <li><strong>使用<code>wx.closeSocket</code>关闭连接</strong>。<code>wx.closeSocket</code>必须在已经连接成功后调用才能关闭连接，为了获知<strong>当前是否已经连接，可以利用<code>wx.onSocketOpen</code>监听连接打开事件</strong></li></ul></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 建立连接</span>
wx<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'ws://127.0.0.1:3000'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听开启</span>
wx<span class="token punctuation">.</span><span class="token function">onSocketOpen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token comment">// 关闭连接</span>
    wx<span class="token punctuation">.</span><span class="token function">closeSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听关闭</span>
wx<span class="token punctuation">.</span><span class="token function">onSocketClose</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;关闭&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="wx-sendsocketmessage"><a href="#wx-sendsocketmessage" class="header-anchor">#</a> wx.sendSocketMessage</h3> <blockquote><ul><li><strong><code>wx.sendSocketMessage</code>用于通过 WebSocket 连接发送数据。在连接成功后，需要在<code>wx.onSocketOpen</code>回调之后才能发送</strong></li> <li>在官方文档中，<code>wx.sendSocketMessage</code>的data类型为String或ArrayBuffer，而不是Array类型，如果给定的是Array类型，在开发者工具中调试不会报错，但是手机中会出现问题，提示错误信息。</li></ul></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 连接</span>
        wx<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'ws://127.0.0.1:3000'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// 监视连接</span>
        wx<span class="token punctuation">.</span><span class="token function">onSocketOpen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">'连接成功了'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 向服务器发送数据</span>
        wx<span class="token punctuation">.</span><span class="token function">sendSocketMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// 监视服务器回复内容</span>
        wx<span class="token punctuation">.</span><span class="token function">onSocketMessage</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">'服务器回复'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="wx-onsocketmessage"><a href="#wx-onsocketmessage" class="header-anchor">#</a> wx.onSocketMessage</h3> <blockquote><p>**<code>wx.onSocketMessage</code>用于监听WebSocket接收到服务器的消息事件。**在回调函数中接收msg参数，通过msg.data可以获取服务器返回的消息</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 建立连接</span>
wx<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'ws://127.0.0.1:3000'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听开启</span>
wx<span class="token punctuation">.</span><span class="token function">onSocketOpen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token comment">// 关闭连接</span>
    wx<span class="token punctuation">.</span><span class="token function">closeSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听服务器送到客户端的消息</span>
wx<span class="token punctuation">.</span><span class="token function">onSocketMessage</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="案例实现"><a href="#案例实现" class="header-anchor">#</a> 案例实现???</h3> <h4 id="编写node-js"><a href="#编写node-js" class="header-anchor">#</a> 编写node.js</h4> <blockquote><p>安装websocket库<code>npm install websocket</code></p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> sd <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'silly-datetime'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> WebSocketServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'websocket'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>server

<span class="token keyword">const</span> httpServer <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'['</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span> <span class="token operator">+</span> <span class="token string">'] Received request for '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> wsServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  httpServer<span class="token punctuation">,</span>
  <span class="token literal-property property">autoAcceptConnections</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

wsServer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">connection</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;message '</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-property property">'content'</span><span class="token operator">:</span> <span class="token string">'自动回复'</span><span class="token punctuation">,</span> <span class="token string-property property">'date'</span><span class="token operator">:</span> sd<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD HH:mm:ss'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token comment">// 服务器返回的信息</span>
      connection<span class="token punctuation">.</span><span class="token function">sendUTF</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 连接的关闭监听</span>
  connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reasonCode<span class="token punctuation">,</span> description</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'['</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'] Peer '</span> <span class="token operator">+</span> connection<span class="token punctuation">.</span>remoteAddress <span class="token operator">+</span> <span class="token string">' disconnected.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 接收控制台的输入</span>
  process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-property property">'content'</span><span class="token operator">:</span> data<span class="token punctuation">,</span> <span class="token string-property property">'date'</span><span class="token operator">:</span> sd<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD HH:mm:ss'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    connection<span class="token punctuation">.</span><span class="token function">sendUTF</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

httpServer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'['</span> <span class="token operator">+</span> sd<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD HH:mm:ss'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']  server is listening on port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="编写小程序"><a href="#编写小程序" class="header-anchor">#</a> 编写小程序</h4> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scroll-view</span> <span class="token attr-name">scroll-y</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scroll-top</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{scrollTop}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-news<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{list}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.id}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- 根据角色判断 --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.role === <span class="token punctuation">'</span>me<span class="token punctuation">'</span>}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!-- 自己的消息显示在右侧 --&gt;</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>news-lf<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>new-txt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.content}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>new-img<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/images/me.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- 对方的消息显示在左侧 --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>else</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>new-img<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/images/avatar.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>new-txt new-text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.content}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scroll-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 聊天输入 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 微信小程序处理软键盘弹出布局上移遮住输入框的解决方法 （设置cursor-spacing=&quot;20&quot;）--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入聊天内容...<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindinput</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bindChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>send<span class="token punctuation">&quot;</span></span> <span class="token attr-name">formType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reset<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span> <span class="token attr-name">button-hover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>blue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 初始页面数据</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">scrollTop</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token comment">// 监听页面加载</span>
    <span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      wx<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 本地服务器地址</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'ws://localhost:3000'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 连接成功</span>
      wx<span class="token punctuation">.</span><span class="token function">onSocketOpen</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'连接成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      wx<span class="token punctuation">.</span><span class="token function">onSocketMessage</span><span class="token punctuation">(</span><span class="token parameter">msg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        data<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token operator">++</span>
        data<span class="token punctuation">.</span>role <span class="token operator">=</span> <span class="token string">'server'</span>
        <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>list
        list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">list</span><span class="token operator">:</span> list
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rollingBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 发送内容</span>
    <span class="token literal-property property">massage</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token function-variable function">send</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 判断发送内容是否为空</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">sendSocketMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 我自己的消息</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">)</span>
        <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>list
        list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token operator">++</span><span class="token punctuation">,</span>
          <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">,</span>
          <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">'me'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">list</span><span class="token operator">:</span> list
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rollingBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 弹出提示框</span>
        wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'消息不能为空哦~'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 监听input值的改变</span>
    <span class="token function">bindChange</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> res<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 页面卸载，关闭连接</span>
    <span class="token function">onUnload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      wx<span class="token punctuation">.</span><span class="token function">closeSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'连接已断开'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 聊天内容始终显示在最低端</span>
    <span class="token function">rollingBottom</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      wx<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boundingClientRect</span><span class="token punctuation">(</span><span class="token parameter">rects</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        rects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">rect</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">scrollTop</span><span class="token operator">:</span> rect<span class="token punctuation">.</span>bottom
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><h1 id="框架"><a href="#框架" class="header-anchor">#</a> 框架？？？</h1></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/study/assets/js/app.64a3878e.js" defer></script><script src="/study/assets/js/3.bf789c24.js" defer></script><script src="/study/assets/js/4.41404aa1.js" defer></script>
  </body>
</html>
